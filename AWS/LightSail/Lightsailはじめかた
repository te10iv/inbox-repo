# Lightsailはじめかた

## 個人的所感
-  仕事でLightSail使うなら、勉強すべきと思うが。
- サーバ1台を安く持ちたい　or サーバ自体の勉強目的であれば、サクラやコノハのVPSのほうが良いと思う

## Lightsailとは

AWS Lightsailは、VPS（Virtual Private Server）を簡単に起動・管理できるサービスです。EC2よりもシンプルで、固定料金のパッケージプランで提供されます。

### 主な特徴
- **シンプルな料金体系**: 月額固定料金で、予測可能なコスト
- **簡単なセットアップ**: 数クリックでサーバーを起動可能
- **統合されたサービス**: DNS、ロードバランサー、データベースなどが統合
- **自動バックアップ**: スナップショット機能が標準装備
- **開発者向け**: 小規模なWebアプリケーションや開発環境に最適

### EC2との主な違い
| 項目 | Lightsail | EC2 |
|------|----------|-----|
| 料金体系 | 月額固定料金 | 従量課金（複雑） |
| 設定の複雑さ | シンプル | 柔軟だが複雑 |
| ネットワーク | 自動設定（パブリック） | 手動設定（柔軟） |
| スケーリング | 手動（プラン変更） | 自動スケーリング可能 |
| 用途 | 小規模・中規模 | 大規模・エンタープライズ |

### 適した用途
- 個人ブログ・ポートフォリオサイト
- 小規模なWebアプリケーション
- 開発・テスト環境
- 学習・実験用サーバー
- 静的サイトホスティング

### 不向きな用途
- 大規模なエンタープライズアプリケーション
- 複雑なネットワーク構成が必要な場合
- 高度な自動スケーリングが必要な場合
- 複数のリージョン間での複雑な構成

# Lightsail の“定額に含まれるもの”

Lightsail は VPS の“パッケージ定額” で料金が決まるサービス。
あなたが支払うのは 毎月のバンドル料金のみ。

✔ 定額にすべて含まれる内容

含まれるもの	説明
Lightsail インスタンス（サーバ）	CPU / メモリ / SSD がパッケージで固定
毎月のデータ転送量（送信）	プランに応じて 1TB、2TB… の転送アウトが無料
静的グローバルIP（1つ）	インスタンスにアタッチできる固定IP
DNS管理（最大3ドメイン）	シンプルなDNSゾーンが3つまで無料 ※もちろんドメイン取得は別のどこかで有料
自動スナップショット機能（バックアップ）	自動バックアップが無料（容量は別課金なし）
Lightsail コンテナ（小規模利用）	同プラン内で利用可能（ただし大きく使うと別料金）
Lightsail マネージドデータベース（専用プラン契約時）	インスタンスとは別に“DBバンドル”を買えば定額
※「DNS無料」は Lightsail DNS のみ。Route53ではない。

# Lightsail と組み合わせても無料のサービス
サービス	無料理由
IAM（ユーザー/ロール）	完全無料
VPC の基本構成（サブネット、ルートテーブル、IGW など）	作成自体は無料（通信は後述）
セキュリティグループ	無料
CloudWatch 基本メトリクス	EC2/Lightsail の CPU 使用率などは無料
Lightsail DNS ゾーン（3つまで）	Lightsail専用。AWS Route53とは別物 ※もちろんドメイン取得は別のどこかで有料


## 最安プランのスペックと料金
Linux/Unix版で IPv4付きバンドルの場合、最安は US $5/月 で「0.5 GBメモリ／2 vCPU／20 GB SSD／1 TB転送量」プラン。 
また、IPv6アドレスのみのプランならさらに安く、US $3.50/月 が最安という記載もあります。 
無料枠としても、1年間CDN＋オブジェクトストレージ、3か月無料のインスタンス選択肢がある等のオファーがあります。


## Lightsail の EC2（実体）はパブリックサブネット『相当』に配置される

理由：
Lightsail インスタンスは VPC の外側にある “特別なサブネット（隔離領域）” に置かれており、
常にパブリックIPを持つ前提で直接インターネットに出られる設計 になっているため。
つまり Lightsail のネットワーク構造は、通常の VPC のように
「パブリック／プライベートを選ぶ」概念がありません。
🔍 Lightsail のネットワークの本当の姿
✔ 実際には VPC 内部に“Lightsail 専用サブネット”が自動生成される
Lightsail を最初に使うとき、AWS は裏側でこうします：
あなたのAWSアカウントの中に
“LightsailDefaultVpc” を勝手に作る
その中に Lightsail 専用のサブネット も作る
そこは 常にインターネットゲートウェイ（IGW）に接続されている
👉 この専用サブネットは事実上パブリックサブネット

## 手順

### 1. インスタンスの作成

#### 1-1. Lightsailコンソールにアクセス
1. AWSマネジメントコンソールにログイン
2. 検索バーで「Lightsail」と検索
3. Lightsailサービスを選択

#### 1-2. インスタンス作成
1. 「インスタンスを作成」ボタンをクリック
2. **インスタンスの場所を選択**
   - リージョン: 東京（ap-northeast-1）など
   - 可用性ゾーン: 任意

3. **プラットフォームとイメージを選択**
   - Linux/Unix（推奨）または Windows
   - OS: Amazon Linux、Ubuntu、CentOS など
   - アプリケーション: WordPress、LAMP、Node.js など（Blueprints）

4. **インスタンスプランを選択**
   - $5/月: 0.5 GB RAM, 2 vCPU, 20 GB SSD, 1 TB転送
   - $10/月: 1 GB RAM, 2 vCPU, 40 GB SSD, 2 TB転送
   - $20/月: 2 GB RAM, 2 vCPU, 60 GB SSD, 3 TB転送
   - その他、より高スペックなプランも選択可能

5. **インスタンス名を入力**
   - 例: `my-web-server`、`dev-server` など

6. **タグを追加**（オプション）
   - 環境: dev, staging, prod
   - プロジェクト: project-name など

7. 「インスタンスを作成」をクリック

#### 1-3. インスタンス起動の確認
- インスタンスが「実行中」になるまで数分待機
- 緑色のインジケーターで起動完了を確認

### 2. 静的IPアドレスの設定（推奨）

#### 2-1. 静的IPの作成
1. Lightsailコンソールで「ネットワーキング」タブを選択
2. 「静的IPを作成」をクリック
3. 静的IP名を入力（例: `my-server-static-ip`）
4. アタッチするインスタンスを選択
5. 「作成」をクリック

**重要**: 静的IPを設定しないと、インスタンスを停止・起動するたびにIPアドレスが変わります。

### 3. SSH接続の設定

#### 3-1. SSHキーペアのダウンロード
1. インスタンス詳細画面で「接続」タブを選択
2. 「SSHキーのダウンロード」をクリック
3. キーファイル（例: `LightsailDefaultKey-ap-northeast-1.pem`）を保存
4. キーファイルの権限を変更（Mac/Linux）:
   ```bash
   chmod 400 LightsailDefaultKey-ap-northeast-1.pem
   ```

#### 3-2. SSH接続
```bash
# 接続コマンド（Lightsailコンソールに表示される）
ssh -i ~/path/to/key.pem bitnami@your-instance-ip

# または、ユーザー名が異なる場合
# Amazon Linux: ec2-user
# Ubuntu: ubuntu
# Debian: admin
ssh -i ~/path/to/key.pem ec2-user@your-instance-ip
```

#### 3-3. ブラウザベースのSSH接続（簡単）
1. Lightsailコンソールでインスタンスを選択
2. 「接続」タブの「ブラウザで接続」をクリック
3. ブラウザ内でターミナルが開く（キーファイル不要）

### 4. ファイアウォール（セキュリティグループ）の設定

#### 4-1. ネットワーキングタブで設定
1. インスタンス詳細画面で「ネットワーキング」タブを選択
2. 「ファイアウォール」セクションで「ルールを追加」をクリック
3. 必要なポートを追加:
   - **HTTP**: ポート80（Webサーバー）
   - **HTTPS**: ポート443（SSL/TLS）
   - **SSH**: ポート22（デフォルトで開放）
   - **カスタム**: 任意のポート（例: 3000, 8080）

4. ソースIPを指定:
   - すべてのIP: `0.0.0.0/0`（公開サービス用）
   - 特定のIP: `your-ip/32`（セキュリティ向上）

### 5. ドメインの設定（オプション）

#### 5-1. Lightsail DNSの設定
1. 「ネットワーキング」タブで「DNSゾーンを作成」をクリック
2. ドメイン名を入力（例: `example.com`）
3. DNSレコードを追加:
   - Aレコード: 静的IPアドレスを指定
   - CNAMEレコード: サブドメイン設定

**注意**: ドメイン自体は別のレジストラ（Route53、お名前.comなど）で取得する必要があります。

### 6. スナップショット（バックアップ）の設定

#### 6-1. 手動スナップショット
1. インスタンス詳細画面で「スナップショット」タブを選択
2. 「スナップショットを作成」をクリック
3. スナップショット名を入力
4. 「作成」をクリック

#### 6-2. 自動スナップショット
1. 「スナップショット」タブで「自動スナップショット」を有効化
2. スケジュールを設定（毎日、毎週など）
3. 保持期間を設定（例: 7日間）

### 7. よくある初期設定

#### 7-1. システムの更新（Ubuntu/Debian）
```bash
sudo apt update
sudo apt upgrade -y
```

#### 7-2. システムの更新（Amazon Linux）
```bash
sudo yum update -y
```

#### 7-3. タイムゾーンの設定
```bash
# Ubuntu/Debian
sudo timedatectl set-timezone Asia/Tokyo

# Amazon Linux
sudo timedatectl set-timezone Asia/Tokyo
```

#### 7-4. ユーザーの追加（オプション）
```bash
# 新しいユーザーを作成
sudo adduser newuser
sudo usermod -aG sudo newuser  # sudo権限を付与
```

### 8. よくある使い方

#### 8-1. Webサーバーのセットアップ（Apache）
```bash
# Ubuntu/Debian
sudo apt install apache2 -y
sudo systemctl start apache2
sudo systemctl enable apache2

# ブラウザで http://your-ip にアクセスして確認
```

#### 8-2. Webサーバーのセットアップ（Nginx）
```bash
# Ubuntu/Debian
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### 8-3. Node.jsアプリケーションのデプロイ
```bash
# Node.jsのインストール
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# アプリケーションの起動（例: PM2を使用）
sudo npm install -g pm2
pm2 start app.js
pm2 startup
pm2 save
```

### 9. 料金の確認

#### 9-1. 料金の確認方法
1. Lightsailコンソールで「アカウント」→「請求」を選択
2. 月額料金と使用量を確認
3. 予想外の料金がないか確認

#### 9-2. 追加料金が発生する場合
- **データ転送量超過**: プランの転送量を超えた場合
- **追加ディスク**: インスタンスとは別のディスクを追加した場合
- **スナップショット容量**: 自動スナップショットの保持期間が長い場合
- **ロードバランサー**: ロードバランサーを使用した場合（別料金）

### 10. トラブルシューティング

#### 10-1. SSH接続できない
- **キーファイルの権限**: `chmod 400 key.pem` を確認
- **ファイアウォール**: SSHポート22が開放されているか確認
- **ユーザー名**: OSによって異なる（ec2-user, ubuntu, bitnamiなど）

#### 10-2. Webサイトにアクセスできない
- **ファイアウォール**: ポート80/443が開放されているか確認
- **Webサーバー**: Apache/Nginxが起動しているか確認
- **静的IP**: 静的IPが正しくアタッチされているか確認

#### 10-3. インスタンスが応答しない
- **リソース不足**: CPU/メモリ使用率をCloudWatchで確認
- **ディスク容量**: ディスク使用率を確認
- **再起動**: インスタンスを再起動してみる

### 11. インスタンスの停止・削除

#### 11-1. インスタンスの停止
1. インスタンス詳細画面で「停止」をクリック
2. 確認ダイアログで「停止」を選択
3. **注意**: 停止中も料金が発生します（削除するまで）

#### 11-2. インスタンスの削除
1. インスタンス詳細画面で「削除」をクリック
2. 削除するリソースを選択:
   - インスタンス
   - 静的IP（不要な場合）
   - スナップショット（不要な場合）
3. 確認して「削除」をクリック

**重要**: 削除前に必要なデータのバックアップを取ること！

### 12. ベストプラクティス

#### 12-1. セキュリティ
- **SSHキーの管理**: キーファイルを安全に保管
- **ファイアウォール**: 必要最小限のポートのみ開放
- **定期的な更新**: システムとソフトウェアを定期的に更新
- **パスワード認証**: SSHのパスワード認証を無効化（キー認証のみ）

#### 12-2. バックアップ
- **自動スナップショット**: 有効化して定期的にバックアップ
- **重要なデータ**: 別のストレージ（S3など）にもバックアップ
- **スナップショットのテスト**: 定期的に復元テストを実施

#### 12-3. コスト管理
- **不要なインスタンス**: 使用していないインスタンスは削除
- **静的IP**: 使用していない静的IPは削除（料金が発生）
- **スナップショット**: 古いスナップショットは定期的に削除
- **転送量**: データ転送量を監視して超過を防ぐ

### 13. 参考コマンド（AWS CLI）

```bash
# インスタンス一覧
aws lightsail get-instances

# インスタンスの詳細
aws lightsail get-instance --instance-name my-instance

# 静的IP一覧
aws lightsail get-static-ips

# スナップショット一覧
aws lightsail get-instance-snapshots

# インスタンスの起動
aws lightsail start-instance --instance-name my-instance

# インスタンスの停止
aws lightsail stop-instance --instance-name my-instance

# インスタンスの削除
aws lightsail delete-instance --instance-name my-instance
```

