
AWS DataSync【AWS Black Belt】
https://www.youtube.com/watch?v=j-AgT53vrc0


 AWS Black Belt Online セミナーとは
皆さんこんにちはAWSブラックベルト オンラインセミナーへようこそ本日は
AWSデータシンクというサービスについ て紹介し
ますAWSブラックベルトオンライン セミナーとはサービス別ソリューション別
業種別などのテーマに分けAmazon WEBサービスJAPAN合同会社が提供 するオンラインセミナーシリーズとなって
おり ますこちらが市場にの内容についての注意
点です本市場では資料作成時点のサービス 内容及び価格についてご説明しています
AWSのサービスは常にアップデートを 続けているため最新の情報はAWS公式
ウェブサイトにてご確認くださいまた資業 作成には十分注意しておりますが資業内の
価格とAWS公式ウブサイト記載の価格に 総意があった場合AWS公式ウェブサイト
の価格を優先とさせていただきます
まず私の自己紹介です佐藤深夜と申します 普段は保険業界のお客様に対して技術的な
支援をさせていただいております好きな AWSサービスはAmazonシンプル ストレージサービスS3とAmazon
FSXシリーズです本日はどうかよろしく お願いいたし
ます本セミナーの前提知識と本セミナーの 対象となる方についてご説明しますまず
 受講対象者
前提知識ですAWSのグローバル インフラストラクチャーであったり基本
サービスの知識が必要となりますそして AWSのストレージサービスの概要につい
ての前提知識も必要となります対象となる 方についてですAWSへのデータ移行方法
を学びたいという方そしてAWSデータ シンクの機能を深く知りたい方を対象とし
ており ますこちらがだとなっておりますAWS
 アジェンダ
データシクとはからまずお話ししていき たいと思いますその後AWSデータシク
エージェントタスクについてお話しします そしてAWSデータシクを用いたデータ線
点数の流れをご説明した後他のデータ転送 ソリューションとの比較についても説明し
ます最後に補足と注意点をお話ししたいと 思い
 AWS DataSync とは
ますまずAWSデータシンクとは概要に ついてお話しと思い
ます大量のデータを転送する時の課題とし てはどのようなものがあるでしょうかまず
送信元ストレージからLANであったり1 を経由してAWSクラウへとたどり着く
までに多くの題が直面するので1つ1つ見 ていきたいと思いますまず送信元
ストレージです送信元ストレージの例えば スループなどがボトルネックとなっている
場合もございますそして送信ボン ストレージにおいて送信対処のファイルを 整理したいそういった場合もあるかなと
思い ますLANにおいてはLANがボテネック になることもあります1は1の体液が
ボトルネックとなることがありますそして 伝送路の暗号化をどのように実装するかも
悩みどころかと思われますそして送信先の ストレージはどうでしょうか送信先
ストレージのボトルネックも課題となり がちですそしてデータを転送した後データ
とメタデータがきちんと送信元の ストレージと整合性が取れているかを確認
する必要がございますそしてストレージ 送信元のストレージから送信先の
ストレージ全体を通じてスケジューリング であったりエラーハンドリングそして パフォーマンスの向上について考えなくて
はなりませんでこれらの課題を解決する ためにはスクリプトの開発とデプロイも
課題となってくる場合がござい ますAWSデータシンクとはデータの転送
に関するマネージドサービスですAWS ストレージサービスとオンプレミスなどの
ストレージの間でデータの移動が簡単に 高速に安全に低コストで実現できる
サービス ですAWSデータシンクの全体像について
お話ししますオンプレミスのストレージ からAWSのストレージサービスへと データを転送する際の流れについてお話し
ますまず最初にオンプレミスに エージェントを配置しますこの
エージェントは仮想マシンアプライアンス となっておりますそして送信元と送信先の
ストレージをそれぞれ送信元ロケーション と送信先ロケーションとして設定します
その後転送スケジュールなどを定義した タスクをAWSデータシンクで設定します
そしてタスクを実行しますタスクを実行 するとこのエージェントは送信モト
ロケーションからデータを読み取ります そしてAWSデータシンクへと送信します
その後Aデータシンクは送信先 ロケーションへとデータを保存し
ますAWSデータシンクの特徴として簡単 なデータ転送というものがございます
エージェントをデプロイしてタスクを作成 して実行するだけでデータを転送すること ができますこのエージェントというものは
何かというと容易にセットアップできる 仮想マシンアプライアンスとなっており ますこのエージェントがデータ転送を実行
しますそしてタスクというワードが出てき ましたタスクは送信元ロケーション送信先
ロケーションを設定しますこれらは送信元 ストレージ送信先ストレージに相当します
そして送信対象のファイルの整理であっ たりデータの整合検証方法でやってる
スケジュール待機制限などを設定します タスクを実行することによって特定の
スケジュールで特定のフォルダーファイル だけを待機制限しながら自動的にデータを
転送しデータの整合性も検証することが でき
ます高速なデータ転送も特徴となっており ますエージェントからAWSデータシンク
へとデータを転送する際にマルチ セッション圧縮ロードバランス機能を自動
的に用いますそのため高速なデータ転送が 実現でき
ますまずマルチセッションです エージェントはAWSデータシンクとの間
において同時に複数のTCPセッションを 生成します並列にデータをすることができ
ますそしてこのエージェントとAWS データシンクの間においてデータを圧縮し
て転送することによって効率化することが できますまたロードバランス機能もござい
ますAWSデータシンク側に複数のエンド ポイントを自動生成しますそして
エージェントからデータ転送を行う際に 付加分散することができ
ますAWSデータシンクではデータの暗号 化とエラーハンドリングに対応しており
ますつまセキュリティと高い信頼性を提供 しております伝送路の暗号化であったり
データを保管する際に暗号化することが できますまたネットワークの切断などで
転送に失敗した場合エラーを記録しつつ次 のスケジュールタスクで再送することが
でき ますAWSデータシンクは低コストという
特徴もございます1gbあたり 0.012%USドルのデータ転送料金と
なりますデータ転送に便利な機能を独自 開発デプロイすることなく利用できます
つまり開発であったり運用コストを削減 できると言え
ますAWSデータシンクを用いて実現 できるデータ転送の例についてお話しし
たいと思いますまずAWSデータシンクと 同じアカウント上のAWSサービスを送信
先に指定する場合においてどのよう 組み合わせが実現できるのかについて見て いきたいと思いますまず送信元
ロケーションとしてAmazonS3 AmazonefsAmazonFSX シリーズを指定したとしますするとお客様
管理のストレージはもちろんのことAWS SNbedS35間のストレージであっ
たりAmazonS3Amazonefs AmazonFSXシリーズへの転送は 可能ですそしてオンプレミスのお客様の
例えばNFSであったりsnbの ストレージから転送する場合においても AmazonS3Amazonefs
AmazonFSXシリーズへと転送する ことができ
ますAWSデータシンクと異なる アカウント上のAWSサービスを送信先に
指定する場合について見ていきたいと思い ます先ほどとは組み合わせが異なることが
分かります例えば送信元ロケーションとし てAmazonS3Amazonefs
AmazonFSXシリーズを選択した 場合について考えますすると送信先
ロケーションとしてはAmazonS3 のみ選択することができますAmazon
efsを送信元ロケーションとして選択し て送信先ロケーションとしてAmazon
efsを選択する場合にはどうすればいい でしょうかそういった場合においては
Amazonefsを送信元ロケーション として選択するのでなくて一旦NFSを
送信元ロケーションとして設定しますその 上でAmazonefsのファイル
システムのドメイン名をNFSサーバーの ドメイン名として設定し
ますデータ転送アーキテクチャの例です AWSデータシンクと同じアカウント上の
AWSサービスを送信先ロケーションに 指定する場合ですすると例えば
オンプレミスのデータをAWSデータシク を用いて転送する場合AWSデータシンク
と送信先のストレージサービスというもの は同じAWSアカウント上に存在します
一方でAWSデータシンクと異なる アカウント上のAWSサービスを総進先 ロケーションに指定する場合においては
このようなアーキテクチャとなります オンプレミス側にエージェントを配置して ベスアカウント1というところにAWS
データシンクを用いますそして別AWS アカウント1とは異なるようなアカウント
上のAWSストレージサービスへとデータ を転送しますこちらの場合においては
AWSデータシンクと同じアカウント上の ADSサービスを送信先ロケーションに 指定する場合と比べて実現できる
組み合わせが異なりますのでご注意
くださいそしてAWSデータシンク エージェントについてお話ししたいと思い
 AWS DataSync Agent
ますAWSデータシンクエージェントとは 仮想マシンアプライアンスです送信元
ストレージからデータを読み取ります そしてAWSデータシンクへとデータを 転送すすることができますその際にエラー
ハンドリング暗号化圧縮などを行いながら データを転送し
ますAWSデータシクのエージェントは ハイパーバザールイオンモール
EC通常でエージェントを実行する際には AWSデータシンクエージェントを含む Amiを使用する必要がございますそして
1回のタスクで取り扱うファイル数に応じ て必要なインスタンスクラスが変わります
のでご注意ください例えば2000万 ファイル以下の場合ですとM52xL
そして2000万ファイルを超える場合に おいてはM54xラジを利用する必要は ござい
ますAWSデータシンクエージェントが 不要なケースについてご説明しますこちら
に記載の通りのパターン以外は基本的には エージェントが必要となります同じ
アカウントにおけるAWストレージ サービス感でのデータ転送においては エージェントが不要ですクロスリージョン
も含んでエージェントは不要ですそして AmazonS3と他のAWSストレージ
サービス感でクロスアカウントデータ転送 を実行する場合においてもエージェントは 不要となりますこちらに記載がない
パターンはエージェントが必須となります のでご注意
くださいAWSデータシクのエンド ポイントについて説明しますAWSデータ
シンクとエージェントが通信するエンド ポイントは3つございまして要件に合わせ て選択することができます例えばvpc
エンポイントを利用した際にはadab dirコネクトであったりAWSStoS
VPNを用いてエージェントはAWS データシンクと通信してデータを転送する
ことができ ます続いてAWSデータシンクのタスクに
 AWS DataSync タスク
ついてご説明したいと思い ますAWSのデータシンクタスクとは
AWSデータシンクがどこからどこへ何を どのように転送するかを設定することが
できますそしてこのタスクを実行すること でAWSデータシンクはデータの転送を
スケジュールに従って開始します まず最初に送信元ロケーションとマウント
パスや送信元のフォルダを定義します そして転送するデータを定義することで
あったりスケジュールを設定することが できます待機を制御することもできます
そしてこちらAWSデータシンクでデータ の整合性の検証方法も定義することができ
ます送信先ストレージサービスにおいては 送信先ロケーションとマウントパスや送信
先のフォルダーを定義することができ ます1つ1つ見ていきたいと思い
ます転送するデータを定義する方法につい て見ていきたいと思います送信元
ロケーションから送信先ロケーションへと データを送信する場合3つの設定ができ
ます1つ目がマニフェストによる送信対象 データのリスト化です次にフィルターを
用いて特定の名前のファイルであったり フォルダのみ送信することや送信から除外
することができますそして最後にデータの 同期方法について定義することができ
ますまずマニフェストからお話ししたいと 思いますマニフェストはファイルをリスト
化してそのリスト化した特定のファイル だけを送信することができる機能となって おります指定した送信元ロケーションの
起点となるフォルダーを基準にファイル名 をリスト化しますそして送信対象の
ファイルが複数ある場合においては開業し ます例えば起点となるフォルダの配下に
フォルダというフォルダーがあったとし ますそのPHSフォルダーの中から ピクチャー1というようなファイルであっ
たりピクチャー2というような画像 ファイルを送信したい場合においてはこの ように記載しますまたAmazonS3の
場合においてはバージョンIDを含むこと ができますファイル名にカマであったり
開業用引用フを含む場合においてはダブル クオテーションを用いますマニフェストを
CSVであったりテキストファイルとして AWSデータシンクと同じアカウント同じ
リージョンのAmazonS3バケットへ と保存して利用することができ
ますマニフェストの注意点と参考情報です ディレクトリであったりフォルダー単位で
指定することはできませんファイル名を 含めたフルパスを指定する必要がござい ますそして4096文字であったり104
バイトを超えるファイル名やオブジェクト パスは定義することができないのでご注意
ください重複したファイル名やトパスを 定義できないのでご注意ください後に説明
するフィルタ機能と併用することもでき ないのへご注意
くださいフィルター機能についてお話しし たいと思いますフィルター機能では特定の
パス名前拡張子を記述しますそしてその パターンに一致するデータを転送すること
ができますマニフェストはパターンでは なくて送信したいデータを一覧化します
そしてその一覧化したデータを送信します がフィルターはパターンを記載してその パターンに一致するデータを転送すること
ができますそしてこのフィルタ機能を 用いると転送から除外するパターンも記述
することができ ますフィルタで利用できる特殊文字は3つ ございますワイルドカードとパイプと
バックスラッシュはございますワイルド カードは前方位置または後方位置を表して
おりますパイプはオアを表しております ただこのパイプに関しましてはスデータ
シンクコンソールから設定する場合には 不要となりますbackはESescap
文字となっておりますそしてこの フィルターを持ちいる際にもマニフェスト と同様に送信元ロケーションの起点となる
フォルダーを基準にパス名前拡張を記述し ますそこの際に起点となるフォルダ直下の
フォルダはスラッシュから記述し ますフィルターの例について解します
inclとexcがございますincsは 送信対象のファイルであったりフォルダー
を設定します記述したパターンに一致する フォルダーであったりファイルを送信対象
とするものですxcsは記述したパターン に一致するファイルとフォルダーを送信
対象から除外するものとなります例えば 今回はincsとしてこの4つのパターン
を記述してみたいと思いますその場合は 起点となるフォルダー化のプロット
フォルダプロットと前方一致する フォルダーまたはファイルそして大文字の
プロットフォルダーが転送対象となります このプロッドとプロッドスラッシュという
ものは同じ意味で解釈されますそして大 文字と小文字は区別されます続いてxcs
のパターンについて見ていきたいと思い ますこちらも4つのパターンを記述します
すると起点となるフォルダー直下のプッ
と前方を一致するフォルダーまたは ファイルprod
/m1.テキストそして添付ファイルは
転送対象から除外され
ますフィルターの注意点とティップスに ついて解説しますワイルドカードを用いた
後方1は除外パターンを記述する時のみ 利用できます例えばWiC.のような後方
一致を転送対象としては記述することは できません送信元であったり送信先
ロケーションにAmazonS3を選択し た場合スラッシュというオブジェクトキー をファイルシステムにおけるフォルダとし
て扱います他にもAWSデータSNでおい てはデフォルトでこのドsnapshot
というフォルダーであったりSL. awsdSNであったりSL.AWSSN
であったりSL.gfsのようなこのよう なフォルダーを転送対象から除外しており
ますAWSデータシンクのデータ同期方法 について解説しますAWSデータシンクで
はタスクを設定する際に送信元と送信先 ロケーションで差分が存在する時の挙動と
して全てのデータを送信するか変更した データだけ送信するかを定義できます全て
のデータを送信する場合によいては送信元 ストレージにおいてファイルに変更が
あろうがなかろうが全てのファイルを送信 先ストレージへと送信先ロケーションへと
送信しますそして送信先ロケーション上の データを全て上書きし
ます変更したデータだけ送信する場合に おいてはまず最初にAWSデータシンクは
ストレージ間のデータとメタデータを スキャンしますそして差分を判断します
そして送信元ストレージへデータを編集し た場合送信先ロケーションで浮きするか
保持するかを設定することができますまた 送信元ロケーションでデータを削除した
場合送信先ロケーションにおいて削除し ないような設定ができますキープデリ
filsとなり ますそしてAWSデータシンクにおける
データの整合性の検証方法として3つ ございます3つの検証方法がありますが1
のベリファイザデータtransfを推奨 します1つ目のverifyOnly
Theデータtransfというものは まずデータの転送中にチェックサムに 基づいて整合性を検証しますそして送信
処理が完了した後送信したデータとその メタデータのチェックサムをストレー間で
比較して検証しますverifyall デタinthedesinにおいては
データの転送中チェックサムに基づいて 整合性を検証するのはもちろんのこと送信
処理完了後に全てのデータとそのメタ データのチェックサムをストレージ間で 比較して完全に同期していることを確認し
ます3つ目のパターンでチェック インテグリティデュアリング トランスファーにおいてはデータの転送中
のみチェックサムに基づいて整合性を検証 し ますまた2つ目のパターンのverify
Allデータinthedesinの注意 点についてご説明しますストレー時間で
完全にデータが同期していることが確認 できますけれどもジへのリクエストを発生
する点についてご注意ください例えば AmazonS3を送信元であったり送信
先に選択した場合リクエストにかかる料金 に注意してくださいそしてマニフェストを
利用した場合においては記載したファイル のみの整合性の検証となり ますAmazonS3グレシアフレブル
リトリーバルやグレイシアDEEP アーカイブをロケーションに用いる場合に おいてはverifyAllDATAin
thedestinationはご利用 できないのでご注意ください
AWSデータシンクにおけるメタデータの 扱いについて解説しますコピーされるメタ
データは送信元と送信先ロケーションの 組み合わせに依存しますここでは一部の例
のみ取り扱いまして全ての組み合わせは こちらのドキュメントを参照して ください送信元ストレージとしてNFS
AmazonefsAmazonFSX4 NONタッNFSを呼ぶバージョンですね
AmazonFS4lustAmazon FSX4opengfsを選択します
そしてAmazonS3を送信先 ストレージとして選択しますするとコピー
されるメタデータとしてはファイルと ディレクトリの更新日時であったり poixパーミッションなどがございます
そしてこれらのメタデータをコピーされた 後AWSデータシンクを用いてNFSで
あったりAmazonefsと AmazonS3からリストアすることに よってこれらのメタデータを復縁すること
ができますこの際注意点として AmazonS3へ一旦AWSデータ
シンクでコピーした後に復元する際に 例えばAWSのS3コマンドみたいな
cliのS3のAPIを呼び出すような 機能でダウンロードした場合においては これらのメタデータは保持されないのでご
注意 ください送信元としてNFSAmazon
efsAmazonFSX4ネアonタッ nfoNFSのプロトコルそして
AmazonFSX4Rust AmazonFSX4Opengfs間で 転送する際においては同様にファイルと
ディレクトリーの更新に時であったりま ポジパーミッションなどが保持され
ます送信元としてsmbAmazon FSX4netuponタッsmbを指定
した場合ですねAmazonFSX4 Windowsフイルサーバーを指定して 送信先でもこれらのサービスを指定した
場合においてはコピーされるメタデータと してこちらに記載のものとなります
ファイルのアクセス更新作成日置であっ たりとかNTFSのアクセスコントロ
リストなどがコピーされますリドオンリー であったりシステムなどの属性もコピーさ
れますけれどもこちらの属性については ベストFでの反映となる属性もありますの
でご注意ください詳しくはこちらの ドキュメントを参照してくださいまた注意
点としてsnbであったりAmazon FSX4netuponタッのSMPを
指定したバージョンとAmazonFSX 4Windowsファイルサーバーから AmazonS3へと送信した場合におい
てはデフォルトのpoixメタデータが 作成されてWindowsのメタデータは 破棄されるのでご注意
くださいタスクの設定方法を解説していき たいと思います送信元ロケーションは
Amazonefsで同じアカウントの AmazonS3を送信先ロケーションと
するケースを想定しますまずAmazon efsをロケーションタイプとして設定し
ますそしてファイルシステムを選択します その後マウントパスAWSデータシンクで
転送中のトラフィックを管理する ネットワークインターフェイスが配置さ れるサブネットを指定しますそしてこの際
にはAmazonefsと同じvpcで そして同じアベイラビリティゾーンAZに
マウントターゲットが存在することを確認 します セキュリティグループを設定します
セキュリティグループではAmazon efsのマウントターゲットと同じものを 選択してNFS用のPORT2049が
開かれていることを確認します送信先 ロケーションとしてはAmazonS3を
選択しますバケットとその他ストレージ クラスなどを選択しますそして送信先の
起点となるフォルダーを設定します他にも AmazonS3へとアクセスするための
AWSIMamロールを指定し ます送信対象のデータとして全てを対象に
する場合と先ほど紹介したように マニフェストであったりフィルターを用い
て特定ファイルだけ送信するような設定が 可能
です続いてデータの同期方法を定義したり データの整合性の検証方法を設定します
またAWSデータシンクでエージェントと AWSデータシンクの間でデータ送信に
使用する待機を制御することもでき ますそして送信元ストレージで変更した
ファイルの扱いについても定義しますKe delatfilsを設定すると送信元
ロケーションで削除したファイルは送信先 ロケーションでは削除が反映されず保持さ
れ ますまた送信元で変更したファイルを送信 先で上書きするかも選択しますその他
Amazonefx出上のファイルで コピーするメタデータを選択したりQを
設定することもでき ますQを設定することによってこのタスク を実行した時にこれより前のタスクが完了
するまで急に保存することができ ますスケジュールの設定では毎度の頻度や
クローン式に基づいた設定ができます ただしAWSデータシンクでは1時間未満
の感覚でデータの転送をスケジュールする ことはできないので注意してください1
時間未満の感覚でAWSデータシンクに よるデータ転送が必須の場合にはタスを
複数作成します例えばそれぞれ30分 ずらした上で1時間ごとにデータ転送を
スケジュール実行することによって30分 間隔でデータを転送することができます他
にもスケジュールを設定せずに全てオン デマンドで実行しますがこのオンデマンド
実行を短い感覚で実現するような スクリプトを開発するなどの手段もござい
ますタスク実行に関するレポートやログも 保存できますレポーターに種類あり標準
レベルと詳細レポートがございますログに ついてもエラーなどの基本情報か転送した
全てのファイルを記録するなどレベルを 選択することができます以上がタスクの
設定となります 最後にタスクを実行した際のステータスに
ついて解説しますタスクを実行した際 エージェントが別のタスクを実行中の場合
においてはタスクのステータスがキイング となりますそしてタスクを監視すると
ランチングになりますその後プリペア Ringの段階におい段階で転送対象の
データを決定しますそしてAWSデータ シクはこのトランスファにおいてデータを
転送してデータ転送完了後にこの ベリファイリングで整合性を検証します
そしてタスクの成功か失敗かを記録します 途中でキャンセルした場合においては
キャンセリングイヤホン
 AWS DataSync を用いたデータ転送の流れ
今回のケースにおいてはAmazonEC 通常にエージェントをデプロイします
そしてNFSサーバーからAmazonS 3へとAWSデータシンクを通じてデータ
を転送しますそして今回NFSサーバーと してはAmazonefsを利用します
通常Amazonefsはエージェントを 持ちずにロケーションの設定が可能です
ロケーション作成時にAmazonefs が候補として表示されますただしここに
おいては2位のNFSストレージをしてい ますそのためNFSとしてロケーションを
登録しますNFSサーバーの起点となり ますディレクトリ直下においてこちらの
メタデータを持つようなファイルと ディレクトリを作成し
ますまず最初にエージェントの インストールとアクティベートする流れに ついて説明したいと思いますAmazon
EC通常へと今回はエージェントを インストールしますまず最初にこちらの
コマンドを発行しでAWSデータシンク エージェントが含まれるAmiIDを取得
しますそして取得したAmiを用いてM5 にXlgeタイプのEC2インスタンスを
起動しますこの際にhttp80番の ポートであったりNFSサーバーとの通信
に必要なポートを解放する必要がござい ます他にも今回はパブリックエポイ経由で
AWSデータSNと通信しますパブリック IPアドレスを付与する必要はございます
また今回は非常に少ないファイルを送信 することを想定しておりますけれども 2000万ファイルを超える場合において
はM54xRのEC2インスタンスが必要 となり
ます続いてAWSデータシンクの コンソールにおいてエージェントを作成し
たいと思いますまずエージェントを デプロイする ハイパーバザールイオンモール
を選択しますアクティベーションキーとし てエージェントからアクティベーション
キーを自動的に取得する方法と エージェントのアプリケーションキーを 手動で入力するタイプがございます今回は
自動的に取得するを選択しますそしてここ にエージェントのIPアドレスを入力し
ますそしてこちらのキーを取得するという ボタンを押すことによっ
てするとアクティベーションキーが自動的 に取得できますエージェントの作成に功し
ますこちらのエージェントのステータスが オンラインとなっていれば成功
です続いてタスクを設定していきたいと 思います先ほどお見せしたタスクの設定例
においてはAmazonefsを選択して おりましたけれども今回はロケーション タイプとしてNFSを選択しますこれは
先ほどお話ししたように今回は2位の NFSストレージを総子元ストレージとし
て仮定しているからですロケーション タイプとしてNFSを入力した後NFS
サーバーAmazonefsのIP アドレスを今回は入力しますそして設定例
としてきちんとメタデータが送信先 ロケーションであるAmazonS3へと コピーされるように設定しますコピー
オーナーップコピーパーミッションコピー タイムスタンプとこの3つを選択します
これによって所有者であったりpoix パーミッションであったりタイムスタンプ がAmazonS3へとコピーされるよう
に設定することができます タスクが作成したらタスクを実行します
今回はスケジュールではなくて手動で実行 します必要に応じて履歴からログであっ
たりステータスを確認することもでき ますタスクが完了したら指定した
AmazonS3上のバケットを確認し ますNFSサーバー上のファイルと
ディレクトリがコピーされていることが 分かりますそして今回はこのtest.D
というようなファイルを確認したいと思い ますメタデータを確認するときちんと意図
した通りにメタデータが保持されている ことが分かり
 他のデータ転送ソリューションとの比較
ます続いて他のデータ転送ソリューション と比較してみたいと思い
ますオンプレミスからAWSへデータを 移行する場合について考えます大きく分け
てオンライン転送とオフライン転送に 分かれますさらにオンライン転送では
AWSマネージドサービス例えばAWS データシンクですね他にもツールであっ
たりスクリプトでの実装という選択肢が ございますオフライン転送の場合ですと
AWSスノボーHストレージ オプティマイズがご利用でき ますデータ以降を早く開始したい場合に
おいてはオンライン転送が採用できます そして安定したネットワーク待機が確保
できる場合やAmazonFSXシリーズ やAmazonefsへと接データを移行
したい場合にもオンライン転送が検討でき ます一方で移行時のボトルネックは
オンプレミスとAWS間のネットワーク 待機である場合や移行中にデータをオフ
ラインにできる場合データ以降の スケジュールに余裕がある場合においては オフライン転送も検討できますただし
AWSスノーボールジを利用する際には メタデータの取り扱いに注意して
くださいオンライの選択肢についてお話し したいと思いますAWSデータシンクは
エラーハンドリングデータの整合性検証 スケジューリングなどの便利な機能を
マネージドサービスとして提供しています 利用することによって楽にデータをAWS
へと送信できることがポイントですただし オンライン転送の手段は移行元と移行先
ストレージデータ転送の要件に応じて選択 する必要がございます例えば1つ目のとし
てNFSサーバーからAmazonefs へと楽にデータを同期したいようなケース
を考えますこの際AWSデータシンクでは スケジュールを設定することができデータ
の同期方法や整合性整合性の確認も機能と して提供しておりますそのためAWS
データシクが採用されることが多いです AmazonFSXPネットアップオン
タップへとデータを転送したいケースを 考えます送信元ストレージがオンタップで
ある場合Snapショット単位でブロック 点スは可能なSnapミラーの活用が
適するケースが多いですAWSデータ シンクであったりロボコピーを利用した
場合においてはファイル単位での送信と なる点について注意して くださいAmazonS3へとデータを数
分ごとの感覚で定期的に送信したいケース においてはAWSS3コマンドを用いた
スクリプトベースのデータ転送基盤を構築 する場合もございます
注意点として移行元と移行先ストレージが 同じでも要件が変われば当然適したツール
は変わることに注意してください4つ目の 例としてNFSサーバーからAmazon
S3へとデータを転送したいただしメタ データを保存したいというようなケースに
ついて考えますAWSデータシンクを 用いることでNFSサーバ上のファイルで
あったりディレクトリーのメタデータは こちらの記載に通りAmazonS3上で も保存されますそのためAWSデータ
シンクは適切と思われ ます最後に補足と注意点についてお話しし
 補足と注意点
たいと思い ますこちらが補足と注意点一覧となって
おり ますAWSデータシンクにおいては
ストレージの検出という機能がオプション としてご利用できますエベスデータシンク
によってストレージの検出を利用すること によって移行に関する推奨情報を取得する
ことができますエージェントは オンプレミスストレージの情報を出して
収集してAWSデータシンクへと送信し ます例えば合計利用中利用可能な
ストレージやったりシフ共有の数やNFS アクセスの過データ転送プロトコル
iopsスループットレイデン子なの パフォーマンスをストレージの管理 インターフェイスを通じて収集します
そして収集した情報をAWSデータシンク のパブリックエンドポイントへと送信し
ますそしてAWSデータシクのこの ディスカバリーという機能ストレージの
検出という機能が収集した情報に基づいて コストを最適化した上でパフォーマンスや
リソース要件を満たすAWSストレージ サービスやAWSストレージサービスの
概算の月額コストを提示し ます注意点としてこのストレージの検出
機能を用さ際にはAWSデータシンクへの 通信においてパブリックエンドポイントが 利用されますそして正確な推奨情報の出力
においては14日間以上の情報収集を推奨 しておりますAmazonFSX4net
onTのシAZ構成Amazonefsの ONEZoneストレージクラス
AmazonFSX4Windows ファイルサーバーのSLEAZ構成は ストレージの検出では考慮しませんまた
Amazonvpc内にエージェントを 配置しAmazonvpc内部のリソース に関するストレージの検出もでき
ますエージェントと送信元ストレージの 組み合わせパターンについて解説します
まず1対Nのパターンがございますこれは 単一のエージェントに対して複数の
ストレージを設定します複数のタスクを 設定するしてタスクは必要に応じて急に
入れられます例えば左側のタスクを実行し た時まだ右側ののタスクは終了してい
なかった場合こちらの左側のタスクはQに 出られますそして1対1の場合においては
単一のエージェントに対して単位の ストレージを設定しますN対1の関係も
ございます複数のエージェントに対して 単一のストレージを設定しますこちらの
パターンでは大規模データの意向が高速に 実現でき
ます複数のエージェントを用いることの メリットと注意点について説明したいと
思いますエージェントごとにタスクを設定 しますそして並列でデータを転送すること
によって大規模データの送信を高速化する ことができますそしてタスクごとに送信元
ストレージのマウントパスを開けたり マニフェストやフィルターを利用すること によってデータセットのタスク音の区分を
明確化することができますただし送信元 ストレージであったりネットワークへの
負荷がすのへご注意くださいそして エージェントはそれぞれ別のタスクを設定
しますそのため可用性を高くすることとは 関係がございませんそしてストレージの
検出を行う場合においては1つの ストレージに対してはエージェントは1つ のみ設定することができるのでこちらの
説明とは関係がない点についてご注意 くださいエージェントはどこに配置すべき
か考えたいと思いますオンプレミスから データを移行する場合送信元ロケーション
と近い場所へ配置しますこれはなぜかと 言うとデータを送信する際にAWSデータ
シンクのエージェントは圧縮マルチ セッションロードバランスを実装しますが その効果範囲が広くなるからです仮になん
ですけれどもAmazonEC通常に エージェントを配置するとオンプレミスの 送信元ストレージとエージェントはNFS
やsmbなどの通信となりましてAWS データシンクが提供するような圧縮マルチ
セッションロードバランスの恩恵を受け られませんそのためエージェントは オンプレミスからデータ移行の場合におい
ては送信元ロケーションと近い場所へ配置 し
ます開いているファイルとロックされた ファイルをAWSデータシンクの転送対処
とする時は注意してください開いた ファイルにおいては通常AWSデータ
シンクは開いたファイルを送信することが できますただし転送中にデータが送信元
ストレージで編集された場合データの整合 性検証時にフチと判断します最新の
バージョンを送信するためにはタスクを 再度実行する必要がございますロックされ
たファイルについてもAWデータシンクは ファイルのロックであったりロック解除が できませんADWデータシンクがロックさ
れたファイルを開けない場合そのファイル の転送をスキップしてエラーを記録します
ハードリンクシンボリックリンク ディレクトリの扱いについて解説します これらの扱いは送信元と送信先ストレージ
の組み合わせに依存しますまずハード リンクの扱いについて解説しますここでは
一例のみ紹介します全てのパターンは こちらのドキュメントを参照してください
まず送信元ストレージとしてNFS AmazonefsAmazonFSX4
ネッタonタッのNFSを指定した場合 そしてAmazonFSX4lust
AmazonFSX4opengfsを 選択します送信先として同様のものを選択
しますするとハードリンクは保存されます 一方でsmbであったりAmazon
FSX4netonタッをsmbを指定し た場合やAmazonFSX4
Windowsファイルサーバー間で データを転送する場合ハードリンクは サポートされませんデータ点数は完了する
もののログにエラーが記録されるのでご 注意くださいそして最後にAmazonS
3へとデータを転送する際のハードリンク の扱いについて解説しますハーリンとその
3参照先は別のオブジェクトとして保存さ れますAmazonS3上でハードリンク
を変更しなければAWSデータシクを用い てNFSであったりAmazonefs
AmazonFSX4ネットアオタップで NFSをして指定した場合やAmazon
FSX4lustAmazonFSX4 opengfsとAWSデータシンクを
用いて復元した時ハードリンクも復元でき
ます例えばハードリンクをNFSから AmazonS3へとコピーした場合に ついて考えたいと思いますAmazon
efs上のソースディレクトリー上にH. テキストとそのハードリンクを作成します
すると同じアノード番号であることが 分かりますAWSデータシンクでこれらの
ファイルをAmazonS3へと送信する とハードリンクと参照先が作成されている
ことが分かりますそしてAmazon efs上のH.テキストを変更しサド
タスクを実行すると共に更新されている ことが分かり ますそして最後にAmazonEFS
Amazonefs上のターゲット ディレクトリ上へAWSデータシンクで AmazonS3からこれらのこれらの
ファイルを復元するときちんと ハードディスクリンクが保持されている ことが分かります同じ版となっていること
が分かります一方でAWSS3コマンドで 付言するとハードリンクは保持されないの
でご注意 くださいシンボリックリンクと
ディレクトリの扱いについても送信MOD ストレージと送信先ストレージの 組み合わせに依存しますここでも一例のみ
紹介します全てのパターンはドキュメント を参照して くださいNFSAmazonefs
AmazonFSX4Nアonタップを NFSをしてした場合AmazonFSX
4lustarAmazonFSX4 Opengfs間でデータを転送する場合
においてはシンボリックリンクは保存され ます一方でsmbであったりAmazon
FSX4netuponapのSMAを 指定した場合AmazonFSX4 Windowsファイルサーバー間で
データを転送する場合シンボリックリンク はサポートしません点数は完了します
けれどもログにエラーが記録されるのでご 注意くださいAmazonS3へとデータ
を転送する際にはターゲットパスは保存さ れますそしてNFSAmazonefs
AmazonFSX4netonタッの NFSを指定した場合とAmazon FSX4lusterAmazonFSX
4Opengfsへと付言した時リンクを 復元でき ますディレクトリの扱いについて説明し
ますAmazonS3Aとデータを転送し た時スラッシュがパスのまとなるからの
オブジェクトとして登録されます例えば テストというようなカのディレクトリを
送信した場合においてはテストスラッシュ というカのオブジェクトが登録され
ますSMVサーバーからデータを転送する 際の注意点についてご説明しますsmb
サーバーをマウントしてファイルであっ たりフォルダーメタデータを読み取れる 権限が必要です特にMicrosoft
アクティブディレクトリを利用してる場合 においては注意が必要ですまたDFS名前
であったりAWSデータシンクのsmb サーバーへのアクセスにはケルベロス認証
が使えない点についてご注意ください他に もファイル共有名が日本語の場合
ロケーションの作成ができない点について もご注意
ください最後にこちらがまとめとなって おりますAWSデータシンクを用いること
によってAWSストレージサービスと オンプレミスなどの間でデータの移動を 実現することができますデータの整合性の
検証差分動機スケジューリング待機制御 エラーハンドリング圧縮などのデータ転送
時に便利な機能をAWSデータシンクは マネージドサービスとして提供します
データを送信する際には送信元と送信先 ストレージの組み合わせや要件に応じて
適切な手段を選択して ください以上で本セミナーは終了となり
ますご清聴ありがとうございまし たM
