# AWS Direct Connect 概要〜これだけはおさえておきたいこと〜【AWS Black Belt】

AWS Direct Connect 概要〜これだけはおさえておきたいこと〜【AWS Black Belt】
https://www.youtube.com/watch?v=B6daP3Cvyks

動画の関連情報



チャプター

文字起こし

 AWS Black Belt Online セミナーとは
AWSブラックベルトオンラインセミナー
にようこそ。本セッションではAWS
ダイレクトコネクト概要といたしまして
これだけは抑えていただきたいこと、基本
的なサービスの概要、機能と接続パターン
、上構成についてご紹介いたします。
Wです
別、ソリューション別、業子別などの
テーマに分け、AmazonWeb
サービスJAPAN合同会社が提供する
オンラインセミナーシリーズです。
内容についての注意点ですが、本資料では
資料作成時点のサービス内容に基づきご
説明しています。
AWSのサービスは常にアップデートを
続けているため、最新の情報はAWS公式
ウェブサイトにてご確認ください。
初めに自己紹介をさせていただきます。
AWSの斎藤と申します。普段は優行売り
消費剤のお客様を中心に技術支援してい
ます。好きなサービスはAmazon
VPCです。
 受講対象者
本セミナーはネットワーク担当者に限らず
AWSクラウドに関わるエンジニアの方
全般を対象にしています。
クラウド担当者に求められる技術領域は
ますます広くなってきており、
ネットワークのバックグラウンド、知識が
ない方もダイレクトコネクトの検討設計に
関わる必要がある場合がございます。
方たちにもお伝えしたい内容としており
ます。

 アジェンダ
また本セミナーにおける目標ですがAWS
ダイレクトコネクトを検討する際に必ず
議題に上がるであろう接続パターンと上
構成について理解していただくことです。
ここでは概要に絞ってお伝えしますので、
より詳細な内容について知りたい場合は、
最後に提示するドキュメントや資料、過去
のブラックベルト資料をご確認ください。
今後ダイレクトコネクトの詳細編の
ブラックベルトオンラインセミナー
シリーズの公開も予定しております。
こちらがアジェンダです。初めにAWS
ダイレクトコネクトの概要について説明し
ます。続いて接続パターン上構成について
お話しさせていただきます。


 AWS Direct Connect について
前置きが長くなりましたがそれでは始めて
いきましょう。
AWSダイレクトコネクトはAWSへの
専用ネットワーク接続サービスで
インターネットを返さずお客様の設備と
AWS艦のプライベートネットワーク接続
が実現できます。
接続ポイントとなるダイレクトコネクト
ロケーションは世界中に存在し、日本では
関東、関西、それぞれ複数のロケーション
が提供されています。リストについては
リンク先をご参照ください。
こちらの図ですが、左側はオンレミス、
右側がAWSで、その間をダイレクト
コネクトロケーションで接続します。
資料上DXと記載してる部分がありますが
、ダイレクトコネクトの略勝とご認識
ください。
ダイレクトコネクトはそのダイレクト
コネクトロケーションにあるAWSの
ルーターとAWSクラウド間の範囲で提供
される機能となります。
一方で左側のオンレミスからダイレクト
コネクトロケーション
ダイレクトコネクトロケーション内での
AWSルーターまでの配線については
キャリアデータセンター事業者から提供さ
れるものとなっています。
本資料での図は画面に向かって左側に
オンレミス、右側がAWSクラウドと統一
していますのでその前提でご覧ください。
こちらはダイレクトコネクトロケーション
をクローズアップした図です。ダイレクト
コネクトロケーションではAWSの
ルーターとお客様、またはパートナー様の
ルーターと物理的に校内配線で接続する
ことになります。
校内配線はデータセンター事業者様へ手配
していただき、METmeーと呼ばれる
部屋でパッチパネルを経由して接続され
ます。
次にお客様拠点との接続パターンについて
見てみましょう。
真ん中がダイレクトコネクトロケーション
になりますが、1はお客様のネットワーク
機器をダイレクトコネクトロケーションに
配置いただくパターンです。左側がオン
プレミスで何らかの回線で接続するもの
です。
2はロケーション内にパートナー様の機器
を配置していただいて接続するパターン
です。
パートナー様のネットワーク機器を得て
オンプレミスに接続します。これは
パートナー様のサービスを利用する
パターンになるかと思います。
3はパートナー様のネットワーク機器が
ロケーションにある点は2と同じですが、
そこから特定の拠点に回線を引くのでは
なく、パートナー様が提供される平気を
経由するパターンです。例えばその兵から
複数の拠点に同時に接続するといったこと
が考えられます。
いくつかの接続パターンから選択
組み合わせるなどして効率的に選ぶ
クラウドへ平域接続を実現していただくと
いうことになります。
ここからダイレクトコネクトの仕組み等を
説明していきますが、基本的な
ネットワークの用語について補足させて
いただきます。
1つ目はVという言葉で物理ネットワーク
を複数の論理ネットワークに分割すること
ができる技術です。
ネットワークの柔軟な構築やセキュリティ
の向上が可能になります。
ダイレクトコネクトにおける物理的な接続
をこのVの技術を用いて論理分割して利用
します。
ノンリネットワークはVIDの番号によっ
て識別されます。

## BGP
2つ目はBGPです。
IPネットワークで誰がどのIPアドレス
体を持っているのか経路の情報交換をする
ために使用されるルーティングプロトコル
のことです。ダイレクトコネクトを返して
オンプレミスとAラs間の経路交換をする
時に使われます。


それでは物理接続と論理接続の関係性に
ついて説明します。物理接続はAWS
ダイレクトコネクトのリソースとしては
コネクションまたは単に接続と表現され
ます。コネクションは単一のユーザー専用
となる専用、
またはパートナー様が確保した
コネクションから利用者に供給する形の
ホスト型の2種類があります。
そのコネクションの中にAWSクラウドに
接続するための仮想インターフェイスを
配置します。バーチャルインターフェイス
略してVIと表記します。
このVI単位でVIDを持っていてお客様
ルーターとの間でBGPPを確立すること
になります。
こちらの例だと1つの接続の中にVIが3
つあり、それぞれVIDが100300
と配置されています。


VIのタイプとして画面下に3つの記載を
していますが、プライベート、
トランジット、パブリックとそれぞれ目的
と接続パターンに合わせて使い分けて
いただく必要があります。
接続パターンの詳細は次のスライドからご
説明します。


## 接続パターンについて
それではAWSダイレクトコネクトを用い
たオンプレミストAWSの接続パターンに
ついて説明していきます。
先ほどVIは3種類あると説明しましたが
、それぞれを用いた接続パターンをこちら
に上げていきます。

構成例もこの後説明をしていきますが、目的に応じた選択をする必要がありますので、
AWSダイレクトコネクトを利用するにあたり、理解していただきたい内容になります。

### オンプレミスとVPCをプライベートIPで接続したい場合

- まずダイレクトコネクトゲートウェイの接続が選択肢となります。
  - 複数のVPC、複数のリージョンのVPCに接続が可能です。
  - しかし接続できるVPCの数は20個までなので...
- それより多い接続をしたい場合には2目にあるダイレクトコネクトゲートウェイプAWSトランジットゲートウェイ接続にする必要があります。
  - トランジットゲートウェイはルーティングテーブルを複数設定できるため複雑な経路設計が可能になります。
  - またVPN接続やSD-WANとの接続と様々なネットワーク拡張も可能です。
  - そのような要件がある場合にはトランジットゲートウェイが選択肢となります。


- 3行目の仮想プライベートゲートウェイの接続は従来型の単一のVPCに対する接続方法ですが、
  - 上の2つでこと足りるため今は選択する必要性は少なくなってきています。

- AWS上のパブリックIPに対して専用接続を開してアクセスしたい場合にはパブリック接続が選択肢となります。



## 8.DXGW(Direct Connect Gateway)の接続

- それではそれぞれの構成について見ていきましょう。
- まず始めはこちらのダイレクトコネクトゲートウェイの接続の構成です。
- ダイレクトコネクトゲートウェイはAWSダイレクトコネクトサービスの一部で
- AWSのVPCとオンレミスのネットワークを直接接続する役割を持つコンポーネントです。
- 頭中にある仮想プライベートゲートウェイとはVPCに関連付けて利用するコンポーネントでVPCとオンプレミスを接続するためのゲートウェイとお理解ください。
- プライベートVIFをレクトコネクトゲートウェイに接続。
- ダイレクトコネクトゲートウェイからは複数のVPCの仮想プライベートゲートウェイに関連付けすることで1つのプライベートVIを使い複数のVPCへ同時に接続ができます。
- ダイレクトコネクトゲートウェイは特定のリージョンに紐づかないグローバルのサービスで複数のリージョンのVPCを接続することも可能です。
- BGPのピアは1つでデフォルトではダイレクトコネクトゲートウェに関連付けされている全てのVPCのサイダーがそのままオンプレミスへ候補されます。
- VPCは図では複数にしていますが1つでも問題ありません。
- 自身でプライベートVIを作成する際に合わせてゲートウェイタイプ、ダイレクトコネクトゲートウェイを選択する必要があります。
- パートナー様から払い出してもらう場合には希望する接続方式を伝えるようにしてください。


## 9. VGW（仮想プライベートゲートウェイ） 接続

- こちらはプライベートVIを利用したもう1つのタイプの仮想プライベートゲートウェイの接続です。
- はダイレクトコネクトゲートウェイがなくなり、プライベートVIが直接仮想プライベートゲートウェイに関連付けされています。
- シンプルにVIと単のVPCが接続されるような形です。
- ダイレクトコネクトゲートウェイ自体には追加の料金がかかるものではなく、VPCも1つから利用できるため、特別な理由がない限りこの従来型の方式を選択する必要はございません。
- 特別な理由というのは例えば
  - ダイレクトコネクトゲートウェイと併用ができない
  - AWSVPN Cloudhubの機能が使いたいといったことが以前は考えられましたが
- 放述するトランジットゲートウェイやサイトリンクという機能で代々ができるようになってきたためあえて選ぶ理由がないというものは現状です
- プライベートVIFのケースではまずはダイレクトココネクト
ゲートウェイの接続から検討されるのが推奨です。


## 10.Transit VIF + Transit Gateway

- 続いてトランジットVIを利用したダイレクトコネクトゲートウェイとAWSトランジットゲートウェイを利用する構成となります。
- この構成はダイレクトコネクトゲートウェイより多くのVPC接続をサポートし、複数のルートテーブルを使った通信制御も可能で高いスケーラビリティを持っています。
- またトランジットゲートウェイはVPN接続、SD1接続等の機能を持っているため、より複雑なネットワーク要件にも対応できる構成です。
- なお、ダイレクトコネクトゲートウェイを単体で利用した場合と異なり、オンプレミスに対してVPCのサイダーはそのまま候補されませんので、オンプレミスにするプレックスリストを設定する必要があります。
- ダイレクトコネクトゲートウェイの接続パターンより拡張性が高く活用できる機能も増えますが、トランジットゲートウェイに関わる料金が追加で発生しますので、トランジットゲートウェイの機能が戦いたいかどうかでダイレクトコネクトゲートウェイ単体の接続とどちらにするのか判断するのがいいでしょう。


## 11.Public VIF
- 次にパブリック接続について説明します。
- こちらは中国を除く全のパブリックサービスへの接続性を提供します。
- AWS上のパブリックIPの経路がダイレクトコネクトを貼ったBGPに流れてきますので専用を返してAWS上のパブリックIPのサービスに対してアクセスが可能になります。
- AWSサービスのパブリックエンドポイントだったり、AWS上で展開されるSaasサービスへのアクセスが例として上げられます。
- 注意点としてBGP接続に利用するパブリックIPアドレスをお客様にて用意いただく点です。
- そしてお客様ルーター側でオンレミスのプライベートサイダーを納得する設計にもご注意ください。
- なお、2025年5月時点で約1万2000経路を受信しますので、この数を制限したい場合、BGPコミュニティで経路フィルターをすることをご検討ください。
- ホスト型接続ではPUBLVIには対応してない場合がございますので、事前にパートナー様に利用化費の確認をされることをお勧めいたします。




## 補足１
- VIの種類と接続パターンは以上になりますが、2つ補足をさせてください。
- ダイレクトコネクトは同一コネクション上に複数種類のVIを混在させることが可能です。
- この図ではダイレクトコネクトゲートウェイのプライベートVIFとパブリック接続のパブリックVIを混在にしていますが、仮想プライベートゲートウェイトランジットゲートウェイの構成のVIとも混在が可能です。
- コネクションを共有することで回線の効率的な利用、環境分離、コスト最適化といった論理分割するメリットを得られます。
- 設定できる数の上限についてはクォーターのドキュメントをご参照ください。
- また、パートナー様提供のサービスを利用する場合はこの構成が可能かパートナー様の技術窓口にご確認ください。

## 補足２：ダイレクトコネクトサイト
- 補足の2つ目はダイレクトコネクトサイトという機能についてです。
- AWSグローバルネットワークのバックを返してオンレミISネットワーク缶を接続するものです。
- ダイレクトコネクトゲートウェイに関連付けられたVIを利用してオンレミス環境の通信を不可能にします。
- つまり東京のお客様拠点とアメリカのお客様拠点とをダイレクトコネクトで利用するAWSバックボーンを経由して接続できるというものです。
- ダイレクトコネクトロケーションからリージョンを経由せず直接AWSバックボーンを経由して目的のロケーションを得最短パスの通信を可能にします。
- ダイレクトコネクトの投資を活用し、オンレミス感の安定した通信品質をシンプルな構成で実現できる機能です。


## 冗長構成について
- ここからはAWSダイレクトコネクトで高い回復性を実現するための上調構成について説明します。
- これまでお話しした通りダイレクトコネクトは物理的な接続です。
- ハードウェアの障害メンテナンス等で利用できないことが想定されます。
- お客様自身でダイレクトコネクトのダウンタイムに備えておくことがとても重要です。
- ここでは高い回復性を実現するベストプラクティスということでダイレクトコネクトの上調構成のポイントを説明します。
- KWSでは単一障害点を排除し、あらゆる障害に対する備えをしておくことを推奨しています。
- ダイレクトコネクトにおいてはこちらに上げているハードウェア、ダイレクトコネクトでは複数の接続、オンレミス側では複数のルーターが該当します。
- またダイレクトコネクトロケーションを上調構成とすることが推奨されます。
- さらに上ネットワーク全体で自動ロードバシング及び自動フェイドオーバーを行うためにBGPによる同的ルーティングされた接続を使用することがベストプラクティスです
- 十分なネットワーク容量を確保し、1つのネットワーク接続に障害が起きても待機が引迫性能低下がしないようにする必要があります。
- システム全体としてより高い回復性を求める場合は例えば東京、大阪のマルチージョン構成ダイレクトコネクト全体の障害に備えたVPLのバックアップ経路の用意、通信プロバイダーの上なども考慮しましょう。
- お客様のシステムでどこまで取り入れるかは予算ニーズに合わせて構成を検討してください。
- では具体的なアーキテクチャ例を見ていきましょう。
- こちらはデュアルロケーションシングルリージョンの構成例です。
- この構成は単一リージョンでのワークロードとオンプレミスを接続する際に効果性を実現する標準的な方法です。
- 構成のポイントとしてロケーション障害に対応できるよう2つの異なるダイレクトコネクトロケーションを使用しています。
- ロケーション内でもハードウェア障害回線
- メンテナンスに対応できるよう回線の上をしています。
- また障害があった際にはBGPにより自動で回復できるような構成にしておきます。
- 優先順位付けによるアクティブスタンバイ
- コールコストマルチパスでアクティブアクティブなどが上げられます。
- ダイレクトコネクトゲートウェイVGW等のAWSサービスはアイコンが1つで表現していますが、内部的に上。
- この構成のメリットはハードウェア障害、回線障害、ロケーション障害に対応し自動を実現していることです。
- ダイレクトコネクトゲートウェイの接続パターンで受視していますが、
- トランジitVIを利用したトランジットゲートウェイの構成パターンでも利用可能


- こちらはデュアルロケーションマルチリジョンの構成です。
- 複数のAWSリージョンを利用するワークロードとオンレミスを接続する上構成例です。
- パークロードが東京リージョン、大阪リージョンを利用しているのに合わせダイレクトコネクトロケーションも東京、大阪と距離の離れた選択をしています。
- 前の例と同様にロケーション内での回線も冗長します。
- 複数のAWSリージョンのVPCへの接続はグローバルサービスであるダイレクトコネクトゲートウェイに接続しています。
- トランジットゲートウェイのパターンでも利用は可能です。
- この構成のメリットはリージョン間の上性の確保であり、災害対策としても機能します。
- 知理的な分散によるリスク軽減を実現したい場合には有効な方法であり、最も高い火用性を実現する方法の1つです。


