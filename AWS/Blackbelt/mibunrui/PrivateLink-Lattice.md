PrivateLink and Lattice - Amazon VPC Lattice Service 編【AWS Black Belt】
https://www.youtube.com/watch?v=6_s_KuKkahY

## 文字起こし

AWS ブラック ベルト オン ライン セミナー へ よう こそ。 1
本 セッション で は プライベート LINK ア ラティス Amazon vpc ラティス サービス 編 と 題し まし て、 サービス 間 の 通信 を 一貫 し て 接続 監視 保護 する アプリケーション レイヤー サービス で ある Amazon vpc Lattice の 基礎 的 な 概念 や 仕組み に つい て ご 紹介 し ます。1
本 セッション を 担当 する の は Amazon WEB サービス JAPAN ソリューション アーキテクト の 中本 と 申し ます。1
普段 の 業務 で は サービス 業 の お 客 様 を 中心 に ご 支援 を し て い ます。1
好き な AWS サービス は 本日 ご 紹介 する Amazon vpc Lattice 含め AWS で の ネットワーク を 構成 する サービス 群 に なり ます。1
AWS に おけ る ネットワーク サービス は 非常 に 奥 が 深い ため、 気 に なる 方 は 是非 本日 ご 紹介 する vpc lats 以外 の サービス に つい て も 調べ て み て ください。1
続い て 対象 者 に つい て です。1
この セッション で は AWS の サービス 感 の 通信 を 一貫 し て 接続 監視 保護 する ため の マネージド サービス で ある Amazon vpc ラテス を ご 紹介 いたし ます。1
え 従っ て これ から AWS を 利用 さ れる 予定 の ネットワーク 担当 者 の 方 から え 現在 ネットワーク 設計 を 担当 し てる 方、 また アプリケーション ネットワーク の 構成 で お 悩み の 方、 そして Amazon vpc Lattice に つい て 深く 学び たい 方々 に も ぴったり な 内容 に なっ て い ます。1
まず 始め に Amazon vpc Lattice が どの よう な 課題 を 解決 する ため に 登場 し た の か その 背景 に つい て 解説 し ます。1
え そして ラティス サービス の 概要 に つい て ご 紹介 し ます。1
また 本 セミナー で は Amazon vpc Lattice の うち Lattice サービス のみ を ご 紹介 し ます。1
vpc リソース コンフィグレーション や リソース プライベート リンク で も 利用 さ れる コンポーネント については、 続編 と し て AWS プライベート リンク に 関する 内容 と 共 に 紹介 する 予定 です の で そちら を ご覧 ください。1, 2
で は 早速 本題 に 入り ます。2
まず Amazon vpc ラティス の 登場 背景 に つい て お 話し し ます。2
初め に モノリス アプリケーション の 課題 を 考え て み ます。2
モノリス アプリケーション で は こちら の よう に 1 つ の コード ベース に の 機能 が 約 さ れ て い ます。2
この よう な モノリス アプリケーション で は 機能 の 数 や アプリ の 複雑 さ が 増える に つれ て 新しい 機能 の 追加、 また 既存 機能 の 変更 が 難しく なる こと が しばしば 発生 し ます。2
この 結果 1 回 の デプロイ に 関連 する 範囲 が 広がり、 エラー が 起き た 時 に 影響 を 受ける 範囲 も 広がる 可能 性 が あり ます。2
また モノリシック アーキテクチャ に は 全て の 機能 が 単一 の コード ベース に 含ま れ て いる ため、 要件 の 変化 に 応じ て アプリケーション 全体 を スケール する 必要 が ある など、 いく つ か の 課題 も 存在 し ます。2
もちろん こちら の モノリス に も メリット は 存在 し、 アプリケーション の 要件 に よっ て は モノリス が 最適 な ケース も ござい ます。2
この よう な モノリス アプリケーション の 課題 を 解決 する ため に、 モノリス アプリケーション を 複数 の マイクロ サービス に 分割 する と いう アプローチ を 取ることが あり ます。2
これ に より 各 サービス は 独立 し て 開発 や 運用 を 行う こと が 可能 と なり、 開発 速度 の 向上 や デプロイ 範囲 の 限定、 また 信頼 性 の 向上 も 期待 する こと が でき ます。2
また これ ら の マイクロ サービス は それぞれ 独立 し て いる ため、 新規 の テクノロジー を 導入 する 際 の 障壁 も 低く なり ます。2, 3
え さらに 各 サービス は 個別 に スケール する こと が でき ます の で、 より 効果 的 な 効率 的 な リソース の 利用 と いっ た ところ が 可能 に なり ます。3
モノリス から マイクロ サービス へ の 移行 で は サービス チーム が より 重要 な 役割 を 果たし て い ます。3
各 チーム は 自分 たち の サービス に 対し て 責任 を 持ち、 その 機能 を API と し て 提供 し ます。3
これ に より 他 の チーム は その API を 使っ て サービス の 利用 を する こと が でき ます。3
マイクロ サービス の 世界 で は アプリケーション は 複数 の サービス が 強調 し て 動作 する こと で 実現 さ れ て い ます。3
これ に は サービス 感 で の 通信 が 必要 不可欠 に なっ て き ます の で、 え サービス 間 の 通信 を 適切 に 設計 実装 する こと が え システム 全体 の パフォーマンス や 信頼 性 を 高める 上 で 非常 に 重要 に なっ て き ます。3
さらに この よう な マイクロ サービス の 環境 は しばしば マルチ アカウント で 構成 さ れ てる こと も あり ます。3
これ に より 各 サービス が 異なる アカウント や リソース を 持つ こと が でき、 より 細やか な アクセス 制御 や リソース の 分離 を 可能 に し ます。3
ただし これ に よっ て サービス 感 の 通信 は さらに 複雑 に なっ て くる と いっ た ところ が え 問題 点 と し て あげ られ ます。3
え サービス 間 の 通信 と その オペレーション に は様々 な 課題 が あり、 疎通 性 の 確保 や サービス ディスカバリー、 ロード バランシング、 認証 認可、 オブザーバビリティ など、 これ ら 全て を 考慮 し 適切 に 設計 実装 する こと が 求め られ ます。3
これ ら の 課題 を 理解 し 適切 な アプローチ を 取る こと で 効果 的 な サービス 感 通信 を 実現 する こと が 可能 と なり ます。3
サービス 感 の 通信 を 実現 する ため に は まず ネットワーク レイヤー で の 疎通 性 の 確保 と トラフィック 管理 が 必要 です。3, 4
これ ら を 実現 する ため の 1 つ の アプローチ と し て AWS が 提供 する トランジット ゲート ウェイ や vpc ピアリング、 プライベート リンク など の サービス が あり、 これ ら の サービス を 利用 する こと で サービス 感 の 通信 が 可能 と なり ます。4
また 従来 こう いっ た サービス 感 の 通信 で は コンテナ 化 と エンボイ プロ 棋士、 また esto、 そして AWS の ECS サービス コネクト や クラウド マップ と いっ た よう な サービス を 組み合わせ て サービス メッシュ の よう な アプローチ を 取っ て い ました。4
これ ら を 活用 する こと で マイクロ サービス 感 の 通信 を 管理 し、 付加 分散 や サービス ディスカバリー など の 機能 を 効果 的 に 利用 する こと が でき ます。4
ただし この アプローチ を 取る 場合 は それぞれ の 技術 要素 の 理解 と 管理 が 必要 に なっ て き ます。4
また サイドカー プロキシ コンテナ の 運用 など 管理 面 で の 複雑 性 が 増し ます。4
え そして マイクロ サービス の 実現 に は それぞれ 異なる 観点 と 要求 を 持つ 2 つ の 役割 を 満たす こと が 求め られ ます。4
1 つ は ネットワーク インフラ 管理 者 の 観点 で、 彼 ら は 開発 者 に 自由 度 を 与え つつ 全体 と し て の 統制 を 保ち たい と 考え、 また 組織 の セキュリティ 基準 を 満たし ながら 中央 で 管理 できる ツール を 求め て い ます。4
一方 開発 者 は ネットワーク の 詳細 を 気 に せ ず に アプリケーション の 開発 に 集中 し たい と 考え、 アプリケーション の 問題 判別 に 役立つ テレメトリ 情報 が 欲しい と 感じ て い ます。4
これ ら の 要求 を 全て 満たす ため の アプローチ を 探求 する こと が マイクロ サービス の 実現 に おい て 重要 に なっ て き ます。4
しかし 既存 の アプローチ に は 多く の 前提 と 考慮 ポイント が あり、 え これ を 克服 する こと が 課題 と なっ て い ます。4, 5
こう いっ た 課題 に 対する 解決 策 の 1 つ と し て 今回 ご 紹介 する Amazon vpc Lattice を 活用 する こと が でき ます。5
vpc Lattice を 使用 する と コンテナ や osss スタック など の 特定 の 技術 に 依存 する こと なく、 様々 な サービス 感 の 通信 を Amazon vpc の ネットワーク サービス だけ で シンプル に 実現 する こと が でき ます。5
これ に より 複雑 な 環境 化 で の マイクロ サービス の 通信 を 効率 的 かつ 安全 に 管理 する こと が 可能 と なり ます。5
で は VP ラティス の 概要 を ご 紹介 いたし ます。5
vpc Lattice の 概要 は、 http 1.1 2.0 また は grpc、 そして TCP を 用い クライアント と サービス 感、 サービス 同士、 そして vpc リソース 感 の 通信 を 可能 と する インフラストラクチャー を 提供 し て い ます。5
本 セミナー で は この 中 で も ラティス サービス に つい て 詳しく ご 紹介 し、 ラティス サービス は http 1.1 2.0 また は grpc を 用い た クライアント と サービス 感、 また は サービス 同士 の 通信 の インフラストラクチャー を 提供 し ます。5
そして これ ら は サービス や サービス ネットワーク を はじめ と し た いく つ か の コンポーネント から 構成 さ れ て い ます。5
で は vpc ラティス を 使用 する 際 の 大まか な 設定 の 流れ に つい て 説明 し ます。5
vpc ラティス で は まず 開発 者 が 1 つ の サービス コンポーネント を vpc ラティス に おけ る サービス と し て 定義 を し ます。5, 6
サービス は 特定 の タスク や 機能 を 実行 する 独立 し て デプロイ 可能 な ソフトウェア の 単位 に なっ て い ます。6
次 に ネットワーク 管理 者 は サービス ネットワーク を 定義 し、 これ は サービス の 集合 の 論理 的 な 境界 と なり ます。6
次 に サービス を サービス ネットワーク に 関連 付ける こと で クライアント から 利用 可能 な 状態 に し ます。6
なお 1 つ の サービス は 複数 の サービス ネットワーク に 関連 付ける こと が でき ます。6
続い て 接続 する 際 の 設定 で、 vpc を サービス ネットワーク に 関連 付ける こと で その vpc 内 の リソース は サービス ネットワーク に 関連 付け られ た サービス 群 と 接続 する こと が 可能 に なり ます。6
また 1 つ の vpc は 1 時点 に おい て 1 つ の サービス ネットワーク に のみ 関連 付ける こと が でき ます。6
対し て 1 つ の サービス ネットワーク に は デフォルト で 最大 500 個 の vpc を 関連 付ける こと が でき ます。6
これ に より vpc 内 の リソース は 関連 付け られ た サービス に 接続 する こと が でき ます。6, 7
また vpc ラティス の 特徴 の 1 つ として、 サービス ネットワーク に 接続 さ れ て いる vpc 同士 は IP アドレス 範囲 が 重複 し て い て も ラティス が 通信 を 中継 する ため 問題 なく クライアント から サービス まで 通信 する こと が でき ます。7
ここ まで が vpc ラティス を 使用 する 際 の 大まか な 設定 の 流れ と なり ます。7
ここ から は サービス 及び サービス ネットワーク の 詳細 に つい て お 話し し、 vpc ラティス の サービス は それぞれ に 固有 の DNS 名 が 払い出さ れ ます。7
また カスタム ドメイン を 設定 する こと も でき、 1 つ の サービス に 対し て 1 つ の カスタム ドメイン を 設定 する こと が でき ます。7
なお カスタム ドメイン は サービス 作成 時 のみ 設定 でき その 後 の 変更 は でき ない こと に ご注意 ください。7
また AWS Certificate Manager で 管理 する 証明 書 を カスタム ドメイン 名 に 割り当てる こと で https リクエスト の 処理 を する こと が でき ます。7
なお デフォルト DNS 名 また は 設定 さ れ た カスタム ドメイン 名 は リンク ローカル アドレス に 解決 さ れ、 これ も vpc ラティス の 特徴 と なっ て い ます。7
サービス に は リスナー、 ルール、 ターゲット グループ と いう コンポーネント が あり ます。7, 8
リスナー に は 1 つ 以上 の ルール を 設定 し、 パス や ヘッダ、 メソッド ベース で マッチング 条件 を 設定 し ます。8
ルール の 評価 条件 と 重み に 基づい て 転送 先 の ターゲット グループ が 決定 さ れ ます。8
重み は 0 から 999 まで 設定 でき、 これ に より サービス の カナリア リリース や ブルー グリーン デプロイ を 実現 する こと が でき ます。8
プロトコル と し て は http か https、 TLS を 選択 し ます。8
アップデート に より TLS パス スルー が サポート さ れ、 お 客 様 は 既存 の TLS また は mtls 実装 を 使用 し て エンド to エンド の 認証 と 暗号 化 を 有効 化 する こと が できる よう に なっ て い ます。8
他 に も grpc で も 通信 が 可能 です が、 grpc を 利用 する 場合 は https と し て 設定 を し て ください。8
また TLS リスナー を 設定 する こと で、 ラティス で は TLS を 終端 し ない ため、 クライアント と サービス 感 の TLS/mTLS 通信 を 実現 する こと が でき ます。8, 9
TLS の 場合 は カスタム ドメイン の 設定 が 必須 と なっ て い ます。9
ターゲット グループ と し て は EC2 インスタンス や IP アドレス、 Lambda 関数、 Application Load Balancer (ALB)、 ECS サービス、 Kubernetes の Pod と いっ た リソース を 指定 する こと が でき ます。9
また ALB と Lambda 以外 に 対し て ヘルス チェック 機能 を 提供 し て い ます。9
ECS も 2024 年 11 月 の アップデート に より サポート さ れる よう に なり、 AWS コンピューティング サービス 全体 で アプリケーション を 接続 管理 できる よう に なっ て い ます。9
これ に より 例えば EC2 で 実装 し て い た サービス を Lambda に 移行 する など の 全身 的 な マイグレーション も 可能 です。9
オンプレミス の アプリケーション を 登録 し たい 場合 は、 ALB の ターゲット に オンプレミス の IP アドレス を 指定 する こと で 実装 可能 です。10
セキュリティ の 機能 と し て サービス ネットワーク と サービス に 対し て 個別 に 認証 タイプ を 設定 でき、 AWS IAM を 選択 し て 認証 ポリシー を 設定 し ます。10
認証 ポリシー は リソース ポリシー の 一種 で、 クライアント が SigV4 署名 付き の リクエスト を 送信 する と 認証 ポリシー に 従っ て アクセス の 可否 が 決定 さ れ ます。10
認証 ポリシー で は vpc ラティス 固有 の 条件 キー を 利用 でき、 例えば 特定 の vpc から の リクエスト は Get メソッド のみ 許可 する と いっった 柔軟 な 判定 が 可能 です。10, 11
vpc を サービス ネットワーク に 関連 付ける 際 に セキュリティ グループ を アタッチ する こと で トラフィック を 制御 し ます。11
また vpc ラティス の マネージド プレフィックス リスト が 提供 さ れ て おり、 これ を 使っ て セキュリティ グループ の ルール を 設定 する こと が でき ます。11
vpc ラティス は AWS Resource Access Manager (RAM) を 使っ て 他 の アカウント に 共有 する こと が でき、 同一 オーガニゼーション 内 及び オーガニゼーション 外 の 指定 が 可能 です。12
これ に より クロス アカウント で サービス 間 を 接続 し、 異なる vpc や アカウント から サービス へ アクセス する こと が できる よう に なり ます。12, 13
ロギング 機能 では、 CloudWatch Logs、 S3 バケット、 Kinesis Data Firehose から 選択 し て サービス へ の アクセス ログ を 出力 でき、 監査 や 分析 に 活用 でき ます。13
料金 は プロビジョンド の 数、 サービス 要求 (リクエスト/接続)、 データ 処理 料金 の 3 つ で 構成 さ れ ます。14
vpc ラティス は PrivateLink に 対応 し て おり、 API の 呼び出し を AWS 内 に 完結 さ せる こと が 可能 です。14
サービス 自体 を 利用 する 場合 に は サービス ネットワーク 型 の vpc エンド ポイント を 作成 する こと で、 関連 付け が ない vpc や 別 リージョン、 オンプレミス から も 利用 可能 と なり ます。15
Lambda を ターゲット と し て 選択 する と、 Lambda の 管理 ページ で イベント トリガー と し て 登録 さ れ ます。15
また マルチ Kubernetes クラスター 環境 に おけ る サービス 間 の 通信 課題 解決 に も 活用 でき、 Gateway API リソース に 対応 する vpc ラティス の リソース を 作成 する こと も でき ます。16
異なる コンピューティング プラットフォーム 間、 例えば Kubernetes、 Lambda、 ECS 間 の 通信 も 同様 に 行う こと が 可能 です。16, 17
従来 多数 の ELB を 利用 し て い た 複雑 な 構成 も、 vpc ラティス を 用いる こと で シンプル に 再 構成 でき、 統合 管理 が 可能 に なり ます。17
まとめ と し て、 vpc ラティス を 利用 する こと で サービス 間 の 通信 課題 を インフラストラクチャー レベル で 解決 する こと が でき ます。17
疎通 性 の 確保、 サービス ディスカバリー、 ロード バランシング、 認証 認可、 オブザーバビリティ の 各 点 に おいて 強力 な 機能 を 提供 し ます。17, 18
また ネットワーク 管理 者 と 開発 者 が それぞれ の 観点 で サービス を 分離 し て 管理 する こと が 可能 です。18
本 セッション の 内容 は 以上 と なり ます。19
ご 清聴 ありがとう ござい まし た。19





