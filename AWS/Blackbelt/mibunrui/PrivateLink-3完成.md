


[ご要望に基づき、ソースの文字起こし内容を一切省略せず、指定されたマークダウン形式（句点「。」で改行し、行頭に「 -」を付与）にて作成します。
読点「、」での改行は行わず、各文末にはソースの該当箇所を付記します。

## 0.
aws ブラックベルト オン ライン セミナー へ よう こそ。 1


本 セッション で は AWS プライベート リンク を ご 紹介 し ます。 1
本 資料 で は 作成 時点 の サービス 内容 や 価格 に つい て ご 説明 し て い ます。 1
最新 情報 は AWS 公式 サイト にて ご 確認 ください。 1
また 資料 作成 に は 十分 注意 し て おり ます が、 本 資料 と AWS 公式 サイト の 内容 や 画格 に 相意 が あっ た 場合 は AWS 公式 サイト の 記載 を 優先 と さ せ て いただき ます。 1
本 セッション を 担当 し ます Amazon Webービス JAャパンソリューション アーキテクト の 竹松 と 申し ます。 1

普段 は 公益 事業 の お 客 様 を 中心 に ご 支援 し て い ます。 1
本 セッション で は プライベート リンク を ご 紹介 し ます。 1
これ から AWS を 利用 予定 の ネットワーク 担当 者 の 方 や 現在 ネットワーク 設計 を 担当 し て いる 方、 プライベート リンク に つい て 深く 学び たい 方々 に ぴったり な 内容 に なり ます。 1
こちら が アジェンダ です。 1
まず プライベート リンク の 概要 を ご 紹介 し ます。 1
プライベート リンク で は 様々 な サービス に 接続 でき ます。 1
その ため 次 に 接続 対象 サービス 別 に 詳細 を 解説 し、 最後 に クォーター 等 に つい て ご 紹介 し ます。 1
本 セッション で は プライベート リンク を 使用 し た Amazon VPCラティス サービス へ の 鉄続 も ご 紹介 し ます。 1
VPC Lattice サービス の 詳細 は 本 セッション の 全編 Amazon VPCラティス サービス 編 を ご覧 ください。 1

## 1.

### プライベート リンク の 概要
で は 早速 本編 に 入り ます。 1
まず プライベート リンク の 概要 です。 1
プライベート リンク と は と いっ た ところ から ユース ケース や 全体 像 など に つい て ご 紹介 し ます。 1
こちら の 図 は プライベート リンク を 利用 し た 接続 の 一例 です。 1
左側 が カスタマー VPC、 右側 が プロバイダー VPC です。 1, 2
左側 の カスタマー VPC 内 に ある アプリケーション が 右側 の プロバイダー VPC 内 に ある アプリケーション の フロント に ある ネットワーク ロード バランサー NLB に 対し て プライベート リンク を 使用 し て 接続 し て い ます。 2
この よう に プライベート リンク で は データ を パブリック インターネット に 公開 する こと なく VPC 間 の 接続 を 確立 する こと が でき ます。 2

### プライベート リンク の 特徴4つ

ここ で プライベート リンク の 特徴 を 4 つ ご 紹介 し ます。 2

- まず カスタマー は プライベート リンク を 通し て 別 VPC 内 の アプリケーション へ カスタマー 側 VPC の サイダー から 払い出さ れる プライベート IP を 使用 し て アクセス でき ます。 2

- 次 に プライベート リンク で の 接続 は AWS ネットワーク 内 に とまっ た 通信 で ある こと です。 2

- さらに 図 で は プライベート リンク ににて プロバイダー VPC の NLBA 接続 し て い ます が、 プライベート リンク で は NLB 以外 に も 様々 な サービス へ 接続 でき ます。 2
カスタマー 側 で は VPC エンド ポイント を 作成 し、 プライベート リンク を 使用 し ます。 2
この 時 接続 し たい サービス に 応じ て VPC エンド ポイント を 作成 する こと で 対応 する サービス に 接続 する こと が でき ます。 2

- そして 最後 に プライベート リンク にて 接続 し た VPC の サイダー 重複 を 許容 する こと が でき ます。 2
基本 的 に VPC の サイダー は 通信 する VPC 同士 で は 調複 し ない よう に 設計 する こと が 非常 に 重要 です。 2
一方 で プライベート リンク を 利用 する こと で サイダー が 重複 し た VPC 間 の 接続 を 確立 する こと が でき ます。 2

### プライベート リンク の 主な ケース 
次 に プライベート リンク の 主な ケース です。 2
左 から ご 説明 し ます。 2

- 1 つ 目 が VPC 以外 に ある AWS サービス へ の 石ア の アクセス です。 2
これ ら の サービス に は Amazon CL Watch や Amazon API ゲートウェイウェイ など の AWS サービス が 該当 し ます。 2, 3

- 2 つ 目 が や かつ シンプル な VPC 間 接続 です。 3
プライベート リンク を 使用 する こと で 車内 共有 サービス を 構築 し、 部署 館 で 石案 に 共有 する こと も でき ます。 3

- 3 つ 目 が サード パーティー の サーズ アプリケーション へ の 席ア の アクセス です。 3
サズ プロバイダー が カスタマー に サービス を 提供 する 際 の 手段 と し て 利用 する こと が でき ます。 3

- そして 4 つ 目 が ハイブリッド クラウド です。 3
オン プレミIS の リソース から プライベート リンク を 使用 し て ダイレクト コネクト また は VPN 経由 で AWS 内 の 特定 の ワークロード に アクセス する こと が でき ます。 3
また オン プレミス に アプリケーション が ある 場合、 プライベート リンク を 使用 し て AWS 内 の アプリケーション から 本 プレミス の アプリケーション に アクセス する こと も でき ます。 3

### プライベート リンク の 全体 像

次 に プライベート リンク の 全体 像 です。 3
左側 が カスタマー VPC、 右側 が プロバイダー VPC です。 3
プライベート リンク で は カスタマー 側 は VPC エンポイント を 通し て AWS サービス や プロバイダー の サービス、 VPC サービス ネットワーク など に 接続 でき ます。 3

また カスタマー で 作成 する VPC エンド ポイント に は インターフェイス エンド ポイント や リソース エンド ポイント など いく つ か 種類 が あり、 それぞれ 異なっ た サービス へ 接続 し て いる こと が 分かる か と 思い ます。 3

プライベート リンク で は 接続 し に いき たい サービス の 種類 に 応じ て 対応 する VPC エンド ポイント を 作成 し 接続 を 確立 し ます。 3
また プライベート リンク で は VPC エンド ポイント が 設置 さ れ た VPC 外 から も 接続 する こと が 可能 です。 3

その 通り 例えば カスタマー VPC 内 の アプリケーション から AWS トランジェット ゲートウェイ で 接続 し て いる VPC 内 に ある VPC エンド ポイント を 通し て 対象 の プロバイダー の アプリケーション に 接続 する こと が 可能 です。 3, 4

また オン プレミス に ある アプリケーション から も AWS ダイレクト コネクト 等 で 接続 し て おり、 VPC エンド ポイント へ の IP 到達 性 が あれ ば 接続 する こと が 可能 です。 4

## 接続 対象 サービス(ゲートウェイ型とインターフェース型による違い)
次 に 接続 対象 サービス の 紹介 です。 4

プライベート リンク で は 接続 し たい サービス に 応じ て 作成 する VPC エンド ポイント の タイプ が 決定 し ます。 4
その ため カスタマー 側 の VPC で は 接続 し たい サービス ごと に VPC エンド ポイント を 作成 し ます。 4

こちら の 表 は 接続 できる サービス、 サービス ごと に 作成 する 必要 の ある VPC エンド ポイント の タイプ の 一覧 です。 4
本 セッション で は 上 4 つ の サービス へ の 接続 に 関し て 詳細 に ご 紹介 し ます。 4
こちら は 他 の VPC 関節 接続 サービス と の 比較 と なり ます。 4
ご 興味 ある 方 は 後ほど ご 確認 ください。 4

ここ から 接続 対象 サービス ごと に 紹介 し て いき ます。 4
まず は AWS サービス です。 4
今回 で の AWS サービス と は S 3 や ダイナモデ DB CLU Watch など の VPC 以外 に ある AWS サービス を 表し ます。 4
この よう な 順番 で ご 紹介 し て いき ます。 4
AWS サービス A は プライベート リンク を 利用 し た インターフェンス エンド ポイント だけ で なく、 プライベート リンク と は 別 の 技術 と なり ます ゲートウェイ エンド ポイント を 利用 し て も 接続 する こと が でき ます。 4
この 2 つ の VPC エンド ポイント の 使い分 が 重要 に なっ て き ます の で、 今回 は ゲートウェンド ポイント を 利用 し た AWS サービス へ の 接続 に つい て も ご 紹介 し ます。 4, 5
VPC エンド ポイント に より AWS サービス へ 接続 する 先体 像 に なり ます。 5
図 で は 左側 の カスタマー VPC 内 の アプリケーション が 右側 の AWS サービス に 接続 し て い ます。 5
VPC エンド ポイント を 利用 せ ず に VPC 内 から AWS サービス に アクセス する 場合、 VPC に インターネット ゲート A を 設置 し て トラフィック が VPC から AWS サービス に 到達 できる よう に する 必要 が あり ます。 5
一方 で VPC エンポイント を 使用 する こと で インターネット ゲート A を 使用 する こと なく AWS サービス へ 接続 する こと が でき ます。 5

### インターフェイス エンド ポイント と ゲートウェイ エンド ポイント
また AWS サービス へ 接続 する 場合 2 種類 の VPC エンド ポイント が あり ます。 5
インターフェイス エンド ポイント と ゲートウェイ エンド ポイント です。 5
の 右側 に ある 通り インターフェイス エンド ポイント は 様々 な AWS サービス に 対応 し て おり ます。 5
一方 で ゲートウェンド ポイント で は S 3 と ダイナモデ に 接続 する こと が でき ます。 5
さらに 左側 の カスタマー の アプリケーション から 各 VPC エンド ポイント へ 接続 する 仕組み も 少し 異なる こと が 分かる か と 思い ます が、 こちら も AWS ネットワーク 内 に とまっ た 通信 と なり ます。 5

### 2 つ の VPC エンド ポイント の 比較
2 つ の VPC エンド ポイント の 比較 です。 5
表 の 左側 が ゲートウェンド ポイント、 右側 が インターフェイス エンド ポイント です。 5
大きな 違い と し て は 対象 の AW サービス や 料金 が 異なり ます。 5
特に ゲート エンド ポイント は 無料 で ある 点 が 大きな ポイント に なる か と 思い ます。 5
また ゲートウェンド ポイント は プライベート リンク と は 別 の 技術 を 用い て いる ため 仕組み も 大きく 異なり ます。 5
ここ から それぞれ の VPC エンド ポイント に フォーカス し て 説明 し て いき ます。 5

## ゲート エンド ポイントについて

### ゲート エンド ポイント を 利用 し て AWS サービス に 接続 する 場合
まず は ゲート エンド ポイント を 利用 し て AWS サービス に 接続 する 場合 です。 5, 6
ゲートウェンド ポイント を 利用 する こと で カスタマー は S 3 と ダイナモデ DB の 2 つ の AWS サービス に 接続 でき ます。 6
図 で は 左側 の カスタマー VPC 内 の アプリケーション が S 3 や ダイナムデ に 接続 し て い ます。 6
この よう に S 3 用 の ゲートウェイ エンド ポイント を 作成 する こと で 作成 し た VPC 内 の アプリケーション が ゲート エンド ポイント を 経由 し て S 3 に 接続 する こと が でき ます。 6
ダイナモデビ に 接続 する 際 も 同様 です。 6
さらに ゲートウェポイント は 追加 料金 なし で 利用 する こと が でき ます。 6

### ゲートウェンド ポイント の 仕組み
次 に ゲートウェンド ポイント の 仕組み です。 6
カスタマー の アプリケーション は ルート テーブル に 基づい て ゲートウェンド ポイント 経緯 で S 3 や ダイナモデ に 接続 し ます。 6
スライド 左側 の 2 つ の 表 は サブネット の ルート テーブル を 表し ます。 6
ゲートウェンド ポイント を 作成 する 際、 有効 化 する サブネット ルート テーブル を 選択 し ます。 6
選択 する と その サブネット ルート テーブル に 表 に ある よう な 送信 先 が S 3 や ダイナモデ の プレフィックス リスト、 ターゲット が ゲートウェンド ポイント の ID と いっ た ルート が 自動 的 に 追加 さ れ ます。 6

- プレフィックス リスト と は 各 AWS サービス の IP アドレス 範囲 の セット に なり ます。 6
カスタマー の アプリケーション は サブネット の ルート テーブル 内 に 追加 さ れ た ルート を も に ゲートウェンド ポイント 経由 で 各 サービス に 接続 を し ます。 6
次 に 考慮 事項 です。 6
ゲート エンド ポイント を 利用 する 際 2 つ 注意 点 が あり ます。 6
1 つ 目 は ゲートウェイ エンド ポイント は 作成 し た VPC 内 のみ で 利用 可能 で ある 点 です。 6
で は VPC ごと に ダイナム デビ 用 の ゲートウェイ エンド ポイント を 作成 し、 接続 し て いる こと が 分かる か と 思い ます。 6, 7
この よう に ゲートウェイ エンド ポイント は トランジット ゲートウェイ など で 接続 し て い た と し て も ゲートウェイ エンド ポイント を 設置 し た VPC 外 から 接続 する こと は でき ませ ん。 7
その ため VPC ごと に ゲートウェイ エンド ポイント を 作成 する 必要 が あり ます。 7
2 つ 目 が 送信 元 の セキュリティ グループ で 送信 先 の S 3 や ダイナモデ DB へ の 通信 許可 が 必要 な 点 です。 7
1 つ 前 の アクセス 方法 で ご 説明 し た 通り、 ゲートウェンド ポイント で は 各 AWS サービス の パブリック IP を 送信 先 と し て 接続 する ため その PUBブリック IP へ の 通信 許可 が 必要 に なり ます。 7
この 時、 各 AWS サービス の プレフィックス リスト を 使用 し て セキュリティ グループ を 設定 する こと が でき ます。 7
最後 に 料金 です。 7
ゲートウェンド ポイント は 追加 料金 なし で 利用 可能 です。 7
その ため 要件 が 合う 場合、 S 3 や ダイナモデ D へ の 接続 に ゲートウェンド ポイント を 利用 する こと で コスト を 抑え つつ 各 サービス へ の 接続 を 確立 する こと が でき ます。 7

## インターフェイス エンド ポイントについて

### インターフェイス エンド ポイント を 利用 し た AWS サービスへの 接続
次 に インターフェイス エンド ポイント を 利用 し た AWS サービス 性 の 接続 に つい て 解説 し て いき ます。 7
それ で は カスタマー VPC 内 の アプリケーション や 本 プレミス に ある アプリケーション から インターフェイス エンド ポイント 経由 で AWS サービス に アクセス を し て い ます。 7
この よう に AWS サービス ごと に インターフェイス エンド ポイント を 作成 する こと で 対象 の AW サービス に 接続 する こと が でき ます。 7
また 図 で は データ センター から インターフェイス エンド ポイント 経由 で AWS サービス に 接続 し て い ます が、 オン プレミス など の インターフェイス エンド ポイント が 設定 さ れ た VPC 以外 から も 接続 する こと が でき ます。 7, 8
この 点 が 先ほど の ゲート エンド ポイント を 利用 し た 際 大きく 異なる 点 の 1 つ に なり ます。 8
また インターフェイス エンド ポイント で は S 3 や ダイナモデ 以外 に も 対応 する 多数 の AWS サービス に 接続 する こと が でき ます。 8

### インターフェイス エンド ポイント の 仕組み
次 に インターフェイス エンド ポイント の 仕組み です。 8
その 通り インターフェイス エンド ポイント は 1 つ 以上 の サブネット に またがる ENI の 集合 です。 8
この ENI を 通じ て 対象 の AW サービス へ 接続 を 行い ます。 8
インターフェース ポイント を 作成 する 際、 有効 化 する アベイラビリティ ゾーン AZ を 選択 する こと で 複数 の AZ、 つまり 複数 の サブネット に ENI が またがる よう に インターフェース エンド ポイント を 設置 する こと が でき ます。 8
こちら の 図 は 2 つ の AZ で 融合 化 し た 場合 の 例 に なり ます。 8
また ENI ごと にサブネット の アドレス 範囲 から プライベート IP が 割り当て られ サービス へ の 接続 に 利用 さ れ ます。 8
さらに インターフェイス エンド ポイント ごと に セキュリティ グループ を 設定 する こと も でき、 待液 幅 も デフォルト で AZ ごと に 10GS を サポート し て おり、 自動 的 に 最大 100GPS まで 拡張 が さ れ ます。 8

### インターフェース エンド ポイント の冗長化
ここ で インターフェース エンド ポイント の 上場 化 に つい て ご 紹介 し ます。 8
- インターフェイス エンド ポイント は 1 つ 以上 の サブネット に またがる ENI の 集合 です。 8
その ため 複数 A Z に またがる よう に インターフェース エンド ポイント を 構成 する こと で 高い 火 性 と 対性 を 実現 する こと が でき ます。 8


こちら の 図 は 上側 の カスタマー A の VPC 内 の アプリケーション と 下側 の カスタマー B の VPC 内 アプリケーション が それぞれ CLU watch へ インターフェイス エンド ポイント 経由 で 接続 し て い ます。 8, 9

上 の 図 と 下 の 図 の 違い と し て は 上側 で は 単位一 A Z に インターフェンス エンド ポイント を 配置 し て い ます。 9

一方 で 下側 で は 2 つ の AZ に インターフェイス エンド ポイント を 構成 し て い ます。 9
上側 の カスタマー A に おい て インターフェイス エンド ポイント は AZ 1 のみ に 作成 し て おり、 つまり 上 化 が ない 状態 と 言え ます。 9
この 時 AZ 1 にて 障害 が 発生 する と AZ 1 内 の リソース と AZ 2 内 の リソース の 両方 が クラウドウォッチ に アクセス する こと が でき ない 状態 と なり ます。 9

一方 下側 の カスタマー B で はマルチェ に インターフェース エンド ポイント を 設置 し て い ます。 9
する と どちら か 一方 の AZ で 障害 が 発生 し て しまっ た 場合 で も もう 片方 の AZ に ある インターフェイス エンド ポイント を 通し て CLU ウォッチ へ 接続 する こと が でき ます。 9

### Interfaceタイプ３つ

次 に アクセス 方法 です。 9
カスタマー は 3 つ の 方法 で インターフェイス エンド ポイント 経由 で AWS サービス へ アクセス する こと が でき ます。 9

- 参考
  - インターフェイス型VPCエンドポイント名前解決に関する基本説明
  - https://techblog.beex-inc.com/entry/2024/06/27/000000

- 補足
  - Interface Endpoint の DNS 名はその VPC 内でのみ解決可能
  - ただし、VPC Peering　もしくはTransit Gateway + Route53 Resolverを使えば 他VPCからも解決可能

▼Interface タイプ - アクセス方法

アクセス方法
1)
- Interface エンドポイントのリージョナル DNS 名
  - パブリックに名前解決可能(??　DNSまでは到達できるがPIPなので通信到達性はない)
    - リージョナル DNS名の例
      - vpce-xxxx.ap-northeast-1.vpce.amazonaws.com
        - ただしPIPなので、インターネットから名前解決できるわけではない
          - amazonがamazonaws.com 配下で一括管理したいからこうなってい
        - PrivateLink の本質は「通信の閉域化」
          - DNS では閉じてないけど、IP レベルで閉じている
  - メリット
    - AZ 障害時に、自動的に名前解決先の切替が行われる
    - 考慮点
      - 【１】エンドポイントごと DNS 名が異なる
      - 【２】AZ間通信が発生する可能性がある
  - 具体的にいうと
    - Interface VPC Endpoint は AZ ごとに ENI（＝IP）を持つため、実体としては次のようになります。
      - vpce-xxxx-az1.ap-northeast-1.vpce.amazonaws.com（＝10.0.1.10 # AZ-a）
      - vpce-xxxx-az2.ap-northeast-1.vpce.amazonaws.com（＝10.0.2.10 # AZ-c）
    - 一方で、リージョナル DNS 名（例：vpce-xxxx.ap-northeast-1.vpce.amazonaws.com）はこれらを 1つの名前に束ねているだけです。
      - リージョナル DNS名 はAZ を考慮せず、複数ENIをランダムに返す
    - 【１】エンドポイントごと DNS 名が異なる
    - 問題①：接続先AZを制御できない
      - クライアントが AZ-a にいてもDNS 解決結果として AZ-b の ENI が返る可能性がある
      - → 「同一AZ内で閉じたい」という設計意図が崩れる
    - 問題②：障害時の挙動が読みづらい
      - AZ-a 側 Endpoint ENI が障害
      - **しかし DNS キャッシュや TTL の関係で、一部クライアントは 死んでいる ENI を引き続き参照**
      - → **「AZ冗長にしたのに、一部通信が不安定」**という現象が起きる
    - 問題③：責務分界・設計説明が難しい
      - 設計レビューでよく出る質問：
        - 「この通信、AZ跨いでますか？」
        - 「障害時はどの経路にフォールバックしますか？」
        - リージョナル DNS だと、「DNS任せです」「AWSの内部挙動次第です」となり、説明責任を果たしにくい。
    - 【２】AZ間通信が発生する可能性がある
    - 具体例
      - SFTP クライアント：ap-northeast-1a
      - DNS 解決結果：Interface Endpoint（1c）
      - 実際の通信経路：
        - EC2(1a)　→ AWS内部NW→ Interface Endpoint ENI(1c) → PrivateLink → 相手NLB / Transfer Family
    - 何が問題か
    - 問題①：不要なレイテンシ増加
      - AZ間通信は 同一AZより必ず遅い
      - SFTP は制御・データ転送で往復通信が多い
      - → 地味に遅い／体感が悪い
    - 問題②：**AZ間通信コストが発生**
      - 同一AZ：無料
      - **AZ跨ぎ：課金対象（数円/GBだが継続すると無視できない）**
      - **SFTP は：定期バッチ、大容量ファイルになりやすく、コスト事故の温床。**
    - 問題③：可用性設計が破綻する
      - 本来のAZ冗長設計は：AZ-a 障害 → AZ-b に退避
      - しかしリージョナルDNSだと：平常時から 常にAZ跨ぎ
      - 障害時との差がなくなる
      - → 「AZ冗長にしている意味が薄れる」

2)
- Interface エンドポイントのゾーナル DNS 名
  - パブリックに名前解決可能(??　DNSまでは到達できるがPIPなので通信到達性はない)
    - リージョナル DNS名の例
      - vpce-xxxx.ap-northeast-1.vpce.amazonaws.com
        - ただしPIPなので、インターネットから名前解決できるわけではない
          - amazonがamazonaws.com 配下で一括管理したいからこうなってい
        - PrivateLink の本質は「通信の閉域化」
          - DNS では閉じてないけど、IP レベルで閉じている
    - メリット
      - 不要なクロスゾーン通信を防止可能
      - 考慮点
        - エンドポイントごとに DNS 名が異なる

3)
各サービスのパブリックエンドポイントの DNS 名（プライベート DNS 名の有効化）
 ・メリット
  ・サービスごとのパブリックなリージョナル DNS 名でアクセス可能
 ・考慮点
  ・AZ 間通信が発生する可能性がある




それぞれ に 関し て 解説 し て いき ます。 9
まず は 上 から 1 つ 目 と 2 つ 目 の 方法 です。 9

- インターフェイス エンド ポイント を 作成 する と エンド ポイント 単位 で 自動 的 に 1 つ の リージナル DNS 名 と 1 つ 以上 の ドーナル DNS 名 が 作成 さ れ ます。 9
- これ ら の DNS 名 を 利用 し て カスタマー は AWS サービス に アクセス する こと が でき ます。 9
- これ ら 2 つ の DNS 名 の 大きな 違い は 名前 解決 で 変っ て くる プライベート IP の 種類 です。 9
- リージョナルで は インターフェイス エンド ポイント に 紐づく 正常 な 全 ENI の プライベート IP を 返却 し ます。 9
  - その ため 障害 が 発生 し て いる AZ へ の アクセス を 防止 する こと が でき ます。 9, 10
- 一方、 ゾーナル DNS 名 は AZ 単位 で 作成 さ れる もの に なり ます。 10
  - 例えば 図 の よう に 2 つ の AZ に またがる よう に インターフェース エンド ポイント を 作成 し た 場合、 2 つ の ドーナル DNS 名 が 作成 さ れ ます。 10
  - また 名前 解決 結果 と し て は 対象 AZ の ENI の プライベート IP を 返却 し ます。 10
  - その ため 不要 な クロス ゾーン 通信 を 防止 する こと が でき ます。 10
- これ ら 2 つ の インターフェンス エンド ポイント の DNS 名 は それぞれ の 特徴 と ケース に 応じ て 使い分ける こと が でき ます。 10



### 共通の特徴（Interface エンドポイントの①リージョナル DNS 名　②ゾーナル DNS 名）

- ここ から どちら の DNS 名 に も 共通 する 特徴 を ご 紹介 し ます。 10
  - まず DNS 名 は パブリック に 名前 解決 する こと が でき ます。 10
  - **一方 で 名前 解決 結果 が プライベート IP と なる ため、 インターフェス エンド ポイント が 存在 する VPC に アクセス でき ない 限り、 これ ら の プライベート IP を 使用 し て AWS サービス に アクセス する こと が でき ない ため ご 注意ください。** 10
  - また DNS 名 は インターフェイス エンド ポイント や AZ ごと に 変わる 値 と なり ます。 10
  - **その ため アプリケーション 内 から インターフェイス エンド ポイント 経由 で AWS サービス に アクセス する 場合、 使用 する リー名 や ゾーナル DNS 名 に 応じ て アプリケーション を 書き換える 必要 が ある 点 も ご 注意ください。** 10

### ③プライベートDNS名（＝各サービスのパブリックエンドポイントのDNS名）
- 次 に 紹介 する アクセス 方法 は プライベート DNS 名 の 機能 の 有効 化 に より 各 AWS サービス の パブリック エンド ポイント の DDS 名 を 使用 し て プライベート リンク 経由 で アクセス する 方法 に なり ます。 10
- 1 つ 前 の スライダー で 紹介 し た インターフェイス エンド ポイント の DNS 名 で は 使用 する DNS 名 ごと に アプリケーション を 書き換える 必要 が あり まし た。 10, 11
- 一方 で こちら の プライベート DNS 名 の 有効 化 を 実施 する こと で 各 AWS サービス の パブリック エンド ポイント の DNS 名 を 使用 し て 接続 でき ます。 11
- その ため 単一 の DNS 名 を 利用 する こと が でき ます。 11
- 注意点
  - この 場合 DNS 名 は パブリック に 名前 解決 できる もの で は あり ませ ん。 11
  - その ため インターフェイス エンド ポイント を 作成 し た VPC 外 から 名前 解決 する 場合 は ルート 53 エンド ポイント や ルール を 利用 する 必要 が あり ます。 11
    - オンプレミスネットワークからアクセスする場合、Route53 Resolver endpointとResolverルールを使用

## 料金
- 最後 に 料金 です。 11
- スライド に は 東京 リージョン で の 現 時点 で の 料金 を 記載 し て おり ます。 11
- インターフェイス エンド ポイント で は カスタマー に 対し て プロビジョニング さ れ た 各 AZ への エンド ポイント 料金 と エンド ポイント で 処理 さ れる データ ごと の 料金 の 2 つ が 発生 し ます。 11

## エンドポイント共通（GW/IF)のエンドポイントポリシ
- 続い て ゲートウェイ エンド ポイント と インターフェイス エンド ポイント に 共通 する エンド ポイント ポリシ の ご紹介 です。 11
- こちら は 各 エンド ポイント に 対し て 設定 できる リソース の 一種 と なり ます。 11
- どの AWS プリンパル が どの リソース へ アクセス 可能 か を 制御 する こと が でき ます。 11
  - （宛先の？）どのアカウントのS3にはアクセスできる、できない
  - （宛先の？）どのアカウントのLambda関数にはアクセスできる、できない
- アイデンティティベースや、リソースポリシーと併用利用する
- デフォルトではvpceポリシーは未設定。＝フルアクセスが許可されている
- すべてのAWSサービスがvpceポリシーに対応しているわけではなく、リージョンごとに、サポートしているかどうかは異なる
  - ▼AI回答なので要確認
    - 東京リージョンでvpceポリシーに対応しているAWSサービス一覧のURLというのはない（？）
    - AWS CLI で確認する方法（公式推奨）
      - 例（東京リージョンで実行）
        - aws ec2 describe-vpc-endpoint-services \
    --filters Name=service-type,Values=Interface Name=owner,Values=amazon \
    --region ap-northeast-1 \
    --query "ServiceDetails[?VpcEndpointPolicySupported==\`true\`].ServiceName"


## ユースケース
- 最後 に ユース ケース です。 11
- S3 へ 接続 し たい 場合、 ゲートウェイ エンド ポイント と インターフェイス エンド ポイント を 接続 アプリケーション の 場所 に 応じ て 使い分ける こと で、 より 低い コスト で の 接続 を 実現 する こと が でき ます。 11
- その 通り アプリケーション が VPC 内 に ある 場合 は 無償 で ある ゲートウェンド ポイント を 利用 し ます。 11
- 一方 で オン プレミス 上 の アプリケーション から は インターフェス エンド ポイント を 利用 し ます。 11
- この よう に 使い分ける こと で より 低い コスト で の 接続 を 実現 する こと が でき ます。 11, 12
- また S 3 に おい て は プライベート DNS 名 機能 を 利用 し て いる 場合 リクエスト が どこ から 来 た の か に 応じ て どちら の エンド ポイント を 使用 する か 自動 的 に 使い分ける こと が できる 機能 が あり ます。 12
- 詳細 は こちら の AWS ブログ を ご覧 ください。 12
  - AWS ブログ「Amazon S3 のプライベート DNS サポートのご紹介」： 
  - https://aws.amazon.com/jp/blogs/news/introducing-private-dns-support-for-amazon-s3-with-aws-privatelink/
  - オンプレミスからのリクエストは Interface エンドポイント、VPC 内からのリクエストは Gateway エンドポイントを 使用するように自動的に使い分けできる (S3 のみ)

## NLBについて

## NLB を 使用 する エンド ポイント サービス へ 接続 する 場合
- 続い て NLB を 使用 する エンド ポイント サービス へ 接続 する 場合 を ご 紹介 し ます。 12
- ゲートウェイ ロード バランサー を 使用 する エンド ポイント サービス へ の 接続 に つい て は ブラック ベルト ゲートウェイ ロード バランサー 編 を ご 確認ください。 12
- こちら の 順番 で ご 紹介 し て いき ます。 12

### 全体像
- こちら が 全体 像 です。 12
- 右側 の プロバイダー VPC が NLB と EC 2 を エンド ポイント サービス と し て 提供 し て い ます。 12
- 左側 の カスタマー VPC 内 の アプリケーション が インターフェイス エンド ポイント を 通し て プロバイダー 側 の エンド ポイント サービス に 接続 し て い ます。 12
この よう に プロバイダー は 特自 の サービス を エンド ポイント サービス と し て ホスト する こと で プライベート リンク 経由 で 他 VPC の カスタマー に 共有 する こと が でき ます。 12
また 図 の 1番 左側 の データ センター から インターフェイス エンド ポイント、 エンド ポイント サービス と 矢印 が 伸び て いる よう に オン プレミス や トランジット ゲートウェイ で 接続 し た VPC など インターフェイス エンド ポイント が 設置 さ れ た VPC 外 から も 接続 する こと が でき ます。 12

### エンド ポイント サービス の 仕組み
- 次 に プロバイダー 側 で 使用 する エンド ポイント サービス の 仕組み です。 12
- プロバイダー は NLB を 使用 し た アプリケーション を エンド ポイント サービス と し て 設定 する こと で 別 VPC の カスタマー に 共有 する こと が でき ます。 12
- 図 の 緑 枠 内 が エンド ポイント サービス です。 12
- この よう に ロード バランサー と アプリケーション を セット と し て エンド ポイント サービス を 設定 し ます。 12, 13
- また エンド ポイント サービス は NLB で 有効 化 し た AZ で 利用 可能 と なり ます。 13
- NLB で 2 つ の AZ を 有効 化 し、 各 AZ に アプリケーション を 設置 する こと で 高い 火 性 を 確保 する こと が でき ます。 13

### NLB の クロス ゾーン 負荷 分散
- さらに NLB の クロス ゾーン 負荷 分散 と の 併用 も でき ます。 13
複数 AZ で NLB を 有効 化 する 代わり に この NLB の クロス ゾーン 負荷 分散 を 使用 する こと で 例えば 単一 AZ に NLB を 設置 し その 後ろ に 複数 AZ で 設置 さ れ た アプリケーション に 通信 を 流す こと が でき ます。 13
一方 この 際 NLB を ホスト する AZ に 障害 が 発生 し た 場合 アクセス する こと が でき なく なり ます の で ご注意 ください。 13
次 に カスタマー 側 で 設置 する インターフェンス エンド ポイント の 仕組み です。 13
仕組み は AW サービス へ 接続 する 場合 の 中 で 説明 し た インターフェイス エンド ポイント と およそ 同じ に なり ます。 13
1 点 追加 で 注意 する 点 と し て 赤 で 書か れ た 文字 を ご覧 ください。 13
エンド ポイント サービス が 利用 可能 な AZ のみ に インターフェイス エンド ポイント を 作成 する こと が でき ます。 13
例えば こちら の 図 は AZ 1 と 2 に またがる よう に インターフェイス エンド ポイント を 設置 し て い ます が、 プロバイダー 側 に て エンド ポイント サービス も AZ 1 と AZ 2 に まがる よう に 設定 さ れ て いる こと が 前提 と なっ て おり ます。 13
次 に 冗長化 に つい て です。 13
図に あり ます 通り、 プロバイダー 側 で は 2 つ 以上 の AZ で NLB を 有効 化 かつ インスタンス を デプロイ し、 さらに カスタマー 側 で は 対応 する AZ に インターフェイス エンド ポイント を 作成 する こと で 高い 性 を 実現 する こと が でき ます。 13, 14
ここ で カスタマー と プロバイダー で AWS アカウント が 異なる 場合 に つい て 補足 に なり ます。 14
AWS で は AZ コード と AZ ID の 2 つ を 使用 し て AZ を 管理 し て い ます。 14
AZ コード と は 普段 AWS マネージメント コンソール など で リソース 作成 の 際 に 参照 し て いただい て いる AP-NORTHEAST-1A と いっ た 識別子 です。 14
AZ コード は リージョン 内 で リソース を AZ 全体 に 分散 さ せる ため に 各 AWS アカウント に 対し て AZ を 独立 し て マッピング し て い ます。 14
その ため 図 の よう に 同じ AP-NORTHEAST-1A で も 2 つ の AWS アカウント それぞれ で 物理 的 に は 異なる 場所 と なる 可能 性 が あり ます。 14
一方 で AZ ID は 全 AWS アカウント で 同じ 物理 的 な 場所 を 示す 識別 値 です。 14
その ため アカウント と プロバイダー で AWS アカウント が 異なる 場合 は AZ ID で 同一 性 の 確認 を 行っ て ください。 14
そして サービス の プロバイダー は カスタマー に AZ ID で 指定 し た AZ に VPC エンド ポイント を デプロイ し て もらう、 もしくは カスタマー が 利用 する 可能 性 の ある AZ に あらかじめ エンド ポイント サービス を 構築 し て おく よう に する 必要 が あり ます。 14
次 に アクセス 方法 です。 14
アクセス 方法 は インターフェンス エンド ポイント で AW サービス に 接続 する 場合 と 同様 に 3 つ の 方法 が あり ます。 14
まず インターフェイス エンド ポイント 単位 で 自動 的 に 付与 さ れる DNS 名 です。 14
こちら は AWS サービス へ 接続 する 場合 と 同様 に リージナル DNS 名 と ゾーナル DNS 名 が 付与 さ れ ます の で ユースケース に 応じ て 使い分ける こと が でき ます。 14
次 に プライベート DNS 名 の 機能 を 有効 化 する 方法 です。 14
こちら は AW サービス に インターフェイス エンド ポイント で 接続 する 場合 と 少し 異なり ます。 14, 15
プライベート DNS 名 を 有効 化 する と プロバイダー 側 で エンド ポイント サービス に DNS 名 を 設定 し て いる 場合 カスタマー は その DNS 名 を 使用 し て アクセス する こと が でき ます。 15
その ため お 好き な DNS 名 を エンド ポイント サービス に 設定 いただく こと で カスタマー に その DNS 名 で アクセス さ せる こと が でき ます。 15
注意 と し まし て この 際 設定 できる の は パブリック な ドメイン 名 で あり かつ ドメイン 所有 権 の 検証 は 必須 と なり ます。 15
次 に クロス リージョン 接続 です。 15
カスタマー と プロバイダー 間 の クロス リージョン 接続 に 対応 し て い ます。 15
この 時 図 に あり ます 通り クロス リージョン の 場合 は カスタマー と プロバイダー 間 で AZ の 整合 性 を 取る 必要 は あり ませ ん。 15
また プロバイダー で は 公開 性 の 観点 から 少なく とも 2 つ 以上 の AZ を 使用 する 必要 が あり ます。 15
次 に UDP サポート に つい て です。 15
プライベート リンク と NLB にて UDP を サポート し て い ます。 15
現 時点 で は NLB の UDP サポート で は NLB の ターゲット が IPv6 のみ に なり ます の で ご注意ください。 15
料金 です。 15
カスタマー側 で は プロビジュニング さ れ た 各 AZ への エンド ポイント 料金 や データ 処理 料金 が 発生 し ます。 15
一方 で プロバイダー 側 で は NLB や アプリケーション を 稼働 さ せ て いる インスタンス 等 の 料金 が 発生 し ます。 15
また クロス リージョン 利用 時 に は 通常 の プライベート リンク 料金 に 加え て この よう な 料金 が 発生 し ます。 15
カスタマー 側 で は リージョン 間 で 転送 さ れる データ の 処理 料金、 プロバイダー 側 で は 各 エンド ポイント サービス で 有効 化 さ れ た リージョン ごと に 料金 が 発生 し ます。 15, 16
最後 に ユース ケース を 4 つ ご 紹介 し ます。 16
まず は 自社 内 で の サービス へ の セキュアな アクセス 方法 と し て の 利用 です。 16
2 つ 目 が AWS 上 で 提供 さ れる サーズ サービス へ の セキュア な アクセス 方法 と し て の 利用 です。 16
この 時 プライベート DNS 名 の 機能 を 利用 する こと で 複数 の カスタマー から 統一 さ れ た DNS 名 で アクセス さ せる こと が でき ます。 16
3 つ 目 は オン プレミス から の 接続 です。 16
ダイレクト コネクト 等 で エンド ポイント へ の IP 到達 性 を 確保 する こと で オン プレミス から も アクセス する こと が でき ます。 16
4 つ 目 が オン プレミス へ の 接続 です。 16
図のように オンプレミス サーバー の プライベート IP を NLB の ターゲット と し て 指定 する こと で オン プレミス に ある リソース を エンド ポイント サービス と し て 提供 する こと が でき ます。 16
この 際 オン プレミス サーバー の プライベート IP が 変更 さ れ て しまう と アクセス でき なく なり ます の で ご注意ください。 16
次 に 接続 対象 が VPC リソース の 場合 に つい て ご 紹介 し ます。 16
こちら の 順番 で ご 紹介 し ます。 16
まず VPC リソース の 説明 です。 16
こちら の 図 は VPC リソース の 例 を 示し て い ます。 16
プライベート リンク で の VPC リソース と は VPC 内 に 存在 する リソース、 例えば インスタンス や クラスター データベース、 また それ 以外 に も オン プレミス で 稼働 し て いる リソース、 例えば ストレージ 等 を 表し ます。 16
こちら が プライベート リンク を 通じ て VPC リソース へ 接続 する 際 の 全体 像 に なり ます。 16
図 の 左側 が カスタマー VPC、 右側 が プロバイダー VPC です。 16
その よう に カスタマー は リソース エンド ポイント 経由 で 別 VPC 内 の VPC リソース、 こちら の 例 です と Amazon RDS に 対し て プライベート に アクセス する こと が でき ます。 16, 17
この 時 VPC リソース の 前段 に ロード バランサ を 設置 する こと は 必須 で は なく、 VPC リソース に 対し て 直接 アクセス する こと が でき ます。 17
カスタマー 側 で は 先ほど まで と 同様 に エンド ポイント を 構築 する 必要 が あり ます。 17
一方 で プロバイダー 側 で は リソース ゲートウェイ リソース 設定 を 構築 する 必要 が あり ます。 17
リソース ゲートウェイ は 共有 する VPC リソース が ある VPC へ の 入り口、 リソース 設定 は 共有 する VPC リソース の 定義 に なり ます。 17
こちら が アーキテクチャー の 詳細 です。 17
まず は プロバイダー 側 で 設定 する リソース ゲートウェイ リソース 設定 の 概要 や 仕組み を ご 紹介 し ます。 17
こちら の 図 の 緑 枠 内 が リソース ゲートウェイ に なり ます。 17
リソース ゲートウェイ は 共有 し たい VPC リソース が ある VPC へ の 入り口 と なり、 カスタマー から の 通信 は リソース ゲートウェイ 経由 で VPC リソース へ 送信 さ れ ます。 17
リソース ゲートウェイ は 内部 的 に は ENI の 集合 で 作成 する 際 に 有効 化 し た AZ の サブネット 内 に ENI が 作成 さ れ ます。 17
こちら の 図 は 2 つ の AZ で リソース ゲートウェイ を 有効 化 し た 例 に なり ます。 17
そして VPC リソース への 通信は リソース ゲートウェイ の IP を 送信 元 と し て 送信 さ れ ます。 17
さらに 1 つ ポイント と なり ます が、 多く の AZ の VPC リソース 接続 さ せる に は できる だけ 多く の AZ に またがる よう に 作成 する 必要 が あり ます。 17
また こちら の 図 で は リソース ゲートウェイ で 1 つ の リソース 設定 に よっ て 1 つ の VPC リソース を 共有 し て い ます。 17
一方 で 単一 の リソース ゲートウェイ で VPC 内 の 複数 の VPC リソース を 共有 する こと も でき ます。 17, 18
また リソース ゲートウェイ 自体 に ロード バランサー 機能 は あり ませ ん。 18
次 に プロバイダー 側 で 設定 する もう 1 つ の 要素 で ある リソース 設定 です。 18
リソース 設定 に より 共有 し たい VPC リソース を 定義 し、 カスタマー に どの VPC リソース に どの リソース ゲートウェイ を 通っ て アクセス さ せ たい か を 定義 し ます。 18
リソース 設定 は カスタマー 側 の リソース エンド ポイント の 設定 の 際 に 利用 する ため、 アカウントが 異なる AWS アカウント の 場合 は AWS リソース マネージャー で 共有 する 必要 が あり ます。 18
左側 が 主な 設定 項目 です。 18
リソース 設定 に は いく つ か タイプ が 存在 し ます の で、 その タイプ を 指定 し たり、 共有 し たい VPC リソース の 定義、 さらに 関連 付ける リソース ゲートウェイ など を 設定 し ます。 18
この 際 リソース 設定 に 関連 つけ た リソース ゲートウェイ を 経由 し て VPC リソース へ 通信 が 行わ れ ます。 18
また 右側 は 実際 に VPC リソース を 定義 する 際 に 利用 できる 識別子 です。 18
IP アドレス、 ドメイン 名、 Amazon リソースネーム (ARN) の 3 つ に なり ます。 18
それぞれ 定義 する 際 の 主な 条件 を 列挙 し て い ます。 18
特に ドメイン 名 は パブリック に 名前 解決 可能 で ある こと、 ARN は RDS データベース のみ サポート と なり ます の で ご注意ください。 18
また リソース 設定 に は 4 つ の タイプ が あり、 タイプ ごと に 使用 できる 識別子が 異なる ため、 ユース ケース に 応じ て タイプ を 選択 する 必要 が あり ます。 18
1 つ 目 が 単一 タイプ です。 18
この タイプ は 単一 の VPC リソース を 提供 する 際 に 利用 する もの です。 18
2 つ 目 が グループ タイプ です。 18
この タイプ は 関連 する VPC リソース の 集合 と なり ます。 18
3 つ 目 に 紹介 する 子 タイプ の リソース 設定 の 集合 と なり ます。 18, 19
そして 3 つ 目 が 子 タイプ です。 19
この タイプ は グループ タイプ の リソース 設定 の メンバー で 個別 共有 する こと は でき ませ ん。 19
また 関連 付ける リソース ゲートウェイ は グループ から 継承 さ れ ます。 19
ここ まで 紹介 し た 単一 グループ の タイプ で は 識別子 と し て IP アドレス と ドメイン 名 を 利用 でき ます。 19
そして 最後 の 4 つ 目 が ARN タイプ です。 19
この タイプ で は 名前 の 通り ARN を 識別子 と し て VPC リソース を 個別 に 共有 する こと が でき ます。 19
現 時点 です と RDS データベース のみ が 対象 と なり ます。 19
また この 時 RDS クラスター を 定義 し た 場合 子 リソース 設定 が 自動 的 に 作成 さ れ AWS で 管理 さ れ ます。 19
また この ARN タイプ の リソース 設定 を グループ タイプ の リソース 設定 の 配下 に する こと は でき ませ ん。 19
ここ で リソース ゲートウェイ から VPC リソース へ の 接続 に つい て 少し 深ぼっ て ご 紹介 し ます。 19
まず 図 に あり ます 通り リソース ゲートウェイ が 設置 さ れ た VPC 内 の VPC リソース だけ で なく オン プレミス や VPC ピアリング 接続 で 繋がっ た VPC 内 の VPC リソース など へ も 接続 が 可能 と なっ て おり ます。 19
この 時 リソース ゲートウェイ を 含む VPC から 該当 の VPC リソース へ の IP 到達 性 が 必要 と なり ます。 19
また VPC リソース への 通信は リソース ゲートウェイ の いずれ か の IP アドレス を 送信元 と し て 通信 が 行わ れ ます。 19
その ため VPC リソース から 見る と リソース ゲートウェイ から 通信 が 来 た か の よう に 見える 形 と なり ます。 19
その ため VPC リソース 側 で は リソース ゲートウェイ から の 通信 を 許可 し て いただく 必要 が あり ます。 19
リソース ゲートウェイ に は セキュリティ グループ が 設定 さ れ ます の で、 VPC リソース が リソース ゲートウェイ と 同じ VPC の 場合 は リソース ゲートウェイ の セキュリティ グループ ID にて 通信 許可 を 設定 いただく こと が 可能 です。 19, 20
続い て カスタマー 側 で 設定 する リソース エンド ポイント を ご 説明 し ます。 20
大まかな 仕組み は インターフェンス エンド ポイント と 同じ に なり ます。 20
一方 で リソース エンド ポイント 特有 の 特徴 と し て リソース エンド ポイント に は リソース 設定 を 1 つ 関連 付ける 必要 が あり ます。 20
その ため リソース エンド ポイント を 通し て 接続 さ せ たい VPC リソース を 定義 し て いる リソース 設定 を 1 つ 関連 付ける 必要 が あり ます。 20
また プロバイダー 側 で は 2 つ 以上 の AZ で リソース ゲートウェイ を 設定 し、 さらに カスタマー 側 で は 対応 する AZ に リソース エンド ポイント を 作成 いただく こと で 高い 冗長性を 実現 する こと が 可能 です。 20


次 に アクセス 方法 です。 20
リソース エンド ポイント の リージナル DNS 名 と プライベート DNS 名 の 機能 の 利用 の 2 つ の 方法 と なり ます。 20
まず エンド ポイント の DNS 名 です。 20
インターフェイス エンド ポイント で AWS サービス や エンド ポイント サービス に 接続 する 際 は リージョナル DNS 名 と ゾーナル DNS 名 の 2 種類 が あっ た か と 思い ます。 20
一方 で リソース エンド ポイント で は リージョナル DNS 名 のみ が 自動 的 に 作成 さ れ ます。 20
リソース エンド ポイント に リソース 設定 を 関連 つける こと で 接続 する VPC リソース を 指定 し ます が、 その エンド ポイント に 紐づく VPC リソース に 応じ て リージナル DNS 名 が 自動 的 に 作成 さ れ ます。 20
右 の 写真 は 2 つ の VPC リソース が 紐づい た リソース エンド ポイント の 詳細 画面 に なり ます。 20
赤枠 内 に 注目 する と VPC リソース ごと に リージナル DNS 名 が 払い出さ れ て いる こと が 分かる か と 思い ます。 21
この よう に 1 つ の リソース エンド ポイント で 複数 の VPC リソース に アクセス できる こと も 大きな 特徴 に なり ます。 21
次 に プライベート DNS 名 機能 の 利用 です。 21
こちら の 機能 を 有効 化 する こと で AWS サービス が デフォルト で 提供 する DNS 名 を 使用 し て アクセス する こと が でき ます。 21
注意 点 と し て こちら の 機能 は ARN を 使用 し た リソース 設定 を 利用 する 場合 のみ に 利用 可能 です。 21
また こちら の DNS 名 は パブリック に 名前 解決 できる もの で は ない 点 も ご 注意ください。 21
プライベート DNS 名 の 機能 は 現 時点 で は リソース 設定 を ARN で 構成 し て いる 場合 のみ で 利用 可能 でし た。 21
一方 で リソース 設定 を ドメイン 名 で 構成 し て いる 場合 に リソース 設定 に 指定 し た DNS 名 で カスタマー から アクセス さ せ たい と いっ た こと が ある か と 思い ます。 21
この 場合 現 時点 です と 図 に あり ます 通り プライベート ホスト ゾーン を 作成 し て いただい て エイリアス レコード で アクセス さ せ たい DNS 名 と VPC リソース ごと エンド ポイント ごと に デフォルト で 作成 さ れる DNS 名 を 紐付ける こと で 実現 いただく こと が 可能 です。 21
続い て 料金 です。 21
カスタマー側 で は エンド ポイント あたり の 料金 や データ 処理 料金 が 発生 し ます。 21
この 時 プロビジョニング さ れ た 各 AZ あたり の エンド ポイント あたり の 料金 で は なく エンド ポイント あたり の 料金 と なり ます。 21
また プロバイダー 側 で は VPC リソース 共有 時 に 処理 さ れる データ 処理 料金 が 発生 し ます。 21
最後 に ユース ケース を 2 つ ご 紹介 し ます。 21
まず AWS 上 や オン プレミス に ある サービス の 提供 です。 21, 22
左側 が カスタマー、 右側 が プロバイダー です。 22
この 通り カスタマー から 単一 の リソース エンド ポイント で オンプレミス の ある リソース も 含め て 複数 の VPC リソース へセキュア に アクセス さ せる こと が でき ます。 22
次 に オン プレミス から の アクセス です。 22
ダイレクト コネクト 等 で エンド ポイント へ の IP 到達 性 を 確保 する こと で オン プレミス から も アクセス する こと が でき ます。 22
接続 対象 サービス 別 の 最後 の 紹介 に なり ます。 22
最後 は VPC サービス ネットワーク へ 接続 する 場合 です。 22
VPC ラティス サービス の 詳細 に 関し て は 本 セッション の 全編 と なり ます Amazon VPC ラティス サービス 編 を ご 確認 ください。 22
この よう な 順番 で ご 紹介 し ます。 22
まず 全体 像 です。 22
左側 が カスタマー アカウント、 右側 が プロバイダー アカウント です。 22
図 で は サービス ネットワーク を カスタマー が 管理 し て い ます。 22
この よう に サービス ネットワーク エンド ポイント を 利用 する こと で サービス ネットワーク に 登録 さ れ た サービス や VPC リソース を まとめ て カスタマー に 提供 する こと が でき ます。 22
その ため カスタマー 側 で 1 つ サービス ネットワーク エンド ポイント を 作成 し て いただく こと で 対象 の サービス ネットワーク で 管理 する 複数 の サービス や VPC リソース に 接続 する こと が でき ます。 22
次 に サービス ネットワーク エンド ポイント の 仕組み です。 22
大まか に は 他 の エンド ポイント と 変わり ませ ん が、 エンド ポイント を 作成 する サブネット の サイダー 範囲 に 注意 が 必要 です。 22
IP アドレス タイプ が IPv4 の 場合、 各 ENI に 対し て /28 の 倍数 で サブネット から IP アドレス を 割り当てます。 22
その ため エンド ポイント を 作成 する サブネット 内 に は 連続 し た /28 以上 の ブロック が 利用 可能 で ある 必要 が あり ます。 22, 23
次 に アクセス 方法 です。 23
サービス ネットワーク エンド ポイント の リージナル DNS 名、 プライベート DNS 名 の 機能 を 利用 する こと が でき ます。 23
まず エンド ポイント の リージョナル DNS 名 です。 23
サービス ネットワーク エンド ポイント に 紐付け た サービス ネットワーク 内 の VPC リソース や サービス ごと に デフォルト で 自動 的 に 払い出さ れる もの に なり ます。 23
右 の 写真 は ある サービス ネットワーク エンド ポイント の 詳細 画面 です。 23
この よう に サービス ネットワーク エンド ポイント を 1 つ 作成 する と その エンド ポイント に 関連 付け た サービス ネットワーク 内 の VPC リソース や サービス ごと に DNS 名 が 払い出さ れ ます。 23
次 に プライベート DNS 名 の 機能 の 有効 化 です。 23
こちら の 機能 を 有効 化 する こと で カスタマー は AWS サービス が リソース に デフォルト で 提供 する DNS 名 で アクセス する こと が でき ます。 23
この 場合 も リソース 設定 を ARN で 構成 する VPC リソース のみ で 利用 可能 な 機能 と なり ます の で ご注意ください。 23
次 に 料金 です。 23
サービス ネットワーク を カスタマー で 管理 し て いる 場合、 まず カスタマー 側 に は VPC リソース へ アクセス する 際 の データ 処理 料金 と サービス に 追加 する VPC リソース あたり の 料金 が 発生 し ます。 23
また この 時 サービス ネットワーク エンド ポイント の 料金 は 発生 し ませ ん。 23
一方 プロバイダー 側 で は VPC リソース 共有 時 に 処理 さ れる データ 処理 料金 が 発生 し ます。 23
最後 に ユースケース を 3 つ ご 紹介 し ます。 23
まず サーズ プロバイダー から 複数 社 の サーズ カスタマー の データベース や ストレージ に アクセス する 場合 です。 23
サービス ネットワーク を サーズ カスタマー ごと に 分け て 利用 する こと で 論理 的 に 分離 する こと が でき ます。 23, 24
また 単一 エンド ポイント に よっ て サービス ネットワーク で 管理 する 複数 の VPC リソース に アクセス する こと が でき ます。 24
次 に VPC リソース と サービス 両方 への 接続 です。 24
サービス ネットワーク エンド ポイント を 利用 する こと で 対象 の サービス ネットワーク で 管理 する VPC リソース と サービス の 両方 に 接続 する こと が 可能 です。 24
最後 に オン プレミス から の アクセス です。 24
サービス ネットワーク エンド ポイント が 登場 する 前 まで は サービス ネットワーク に オン プレミス から アクセス する ため に は 踏み台 を 配置 する と いっ た 工夫 が 必要 でし た。 24
一方 図 に あり ます 通り、 サービス ネットワーク エンド ポイント を 活用 する こと で オンプレミス から サービス ネットワーク を 通し て VPC リソース や サービス に アクセス する こと が 可能 と なり ましました。 24
最後 に その 他 と し て クォーター 情報 に なり ます。 24
こちら は 作成時点 で の クォーター の 抜粋に なり ます。 24
プライベート リンク で は リージョン レベル や アカウント レベル で クォーター が ござい ます。 24
また エンド ポイント あたり の 帯域幅 や MTU 等 の 制限 事項 も ござい ます。 24
詳細 や 最新 情報 は 公式 ドキュメント を ご 確認 ください。 24
まとめ です。 24
プライベート リンク で は データ を パブリック インターネット に 公開 する こと なく VPC と AWS サービス の 接続 を 確立 する こと が でき ます。 24
ユース ケース と し まし て は AWS サービス への または VPC 間 の セキュアな アクセス や ハイブリッド クラウド が 上げ られ ます。 24
また IP アドレス が 重複 し て いる ネットワーク 同士 の 接続 に 利用 する こと も でき ます。 24
そして 接続 対象 サービス ごと に 本 セッション で は 詳細 に ご 紹介 し て き まし た が、 AWS サービス や NLB、 ゲートウェイ ロード バランサー を 使用 する エンド ポイント サービス など 様々 な サービス に プライベート リンク を 通し て 接続 する こと が でき ます。 24, 25
本 セッション の 内容 は 以上 と なり ます。 25
ご 清聴 ありがとう ござい まし た。 25

](PrivateLink-1%E5%8E%9F%E6%96%87.md)